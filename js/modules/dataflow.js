define(["jquery","jqueryui","jqueryuictxm","knockout","modules/server/ioHandler","modules/fs/directories","modules/html/toolbar","modules/settings/config","modules/actions/frameActions","modules/graph/graphConstants","modules/gallery/components","modules/gallery/iconOptionsPicker","modules/gallery/decisionEnds","modules/flow/flowManager","modules/fs/fsBrowser","modules/diagram/mouseInteractor","modules/dialogs/newFlowDialog","modules/dialogs/newFolderDialog","modules/dialogs/openFlowDialog","modules/dialogs/createNodeDialog","modules/dialogs/nodePropsDialog","modules/dialogs/findDialog","modules/dialogs/linkPropsDialog","modules/dialogs/aboutDialog","modules/dialogs/infoDialog","modules/dialogs/confirmDialog","modules/dialogs/thumbnailDialog","modules/settings/settingsDialog","modules/dialogs/text1ViewDialog","modules/dialogs/text2ViewDialog","modules/settings/settingsActions","modules/geometry/point","modules/util/utils","modules/draw/draw","modules/controller/flowCache","modules/exportLayout/exportManager","modules/exportLayout/demoFlow","modules/util/integrationText"],function(e,t,n,o,i,a,s,r,l,d,u,c,g,p,m,b,f,v,w,I,N,D,h,M,T,y,C,E,L,F,k,x,O,S,P,A,V,R){function B(e){r.setAppMode(e),d.appMode().FLOW_MODE,Z.flowManager.getSelectionManager().clearSelections(),Z.flowManager.clearNamesCache()}function H(e){e===d.flow().VERTICAL?(pe.removeClass("block-extendV"),pe.addClass("block-extendH"),me.removeClass("block-extendH"),me.addClass("block-extendV"),be.removeClass("block-shrinkV"),be.addClass("block-shrinkH"),fe.removeClass("block-shrinkH"),fe.addClass("block-shrinkV")):e===d.flow().HORIZONTAL&&(pe.removeClass("block-extendH"),pe.addClass("block-extendV"),me.removeClass("block-extendV"),me.addClass("block-extendH"),be.removeClass("block-shrinkH"),be.addClass("block-shrinkV"),fe.removeClass("block-shrinkV"),fe.addClass("block-shrinkH"))}function K(e){e===d.flow().VERTICAL?(Ie.removeClass("block-extendV"),Ie.addClass("block-extendH"),Ne.removeClass("block-shrinkV"),Ne.addClass("block-shrinkH")):e===d.flow().HORIZONTAL&&(Ie.removeClass("block-extendH"),Ie.addClass("block-extendV"),Ne.removeClass("block-shrinkH"),Ne.addClass("block-shrinkV"))}function z(){return Ve?Ve.getName():"[none]"}function W(e){r.setFlowDirection(e),Z.setFlowDirectionChange(),H(e),K(e),Z.getFlowManager().hasDiagramOpen()&&Z.flowManager.setDirty(!0),Z.getFlowManager().refreshDiagramOnEdit(),Z.setConfirmFlag(d.bValue().FALSE)}function _(){e("#settingsDialogId").dialog({position:{my:"right top+10",at:"right top",of:"#topContainerId"}}),e("#nodePropsDialogId").dialog({position:{my:"right top+10",at:"right top",of:"#topContainerId"}}),e("#linkPropsDialogId").dialog({position:{my:"right top+10",at:"right top",of:"#topContainerId"}}),e("#thumbnailDialogId").dialog({position:{my:"right bottom",at:"right-17 bottom-4",of:window}}),e("#findDialogId").dialog({position:{my:"right top",at:"right-4 top-4",of:window}}),U(),Z.repaintDiagram()}function U(){var t=e(window).height();e(window).scrollTop();at.height(t-it)}var Z=this,j=document.getElementById("canvasId"),J=document.getElementById("canvasThId"),q=j.getContext("2d"),X=document.getElementById("containerId"),Q=document.getElementById("topContainerId"),$=(document.getElementById("containerId"),e("#topContainerId"),e("#openFlowDialogId")),G=e("#spinnerLevelsId"),Y=e("#spinnerLanesId"),ee=e("#confirmDialogId"),te=(e("#thumbnailDialogId"),"[select 'New' or 'Open' from menus]"),ne=!1,oe=!1,ie=!1;Z.accHdrDemoTitle=o.observable(d.appTitles().FLOW_TITLE),Z.accHdrPagesTitle=o.observable(d.appTitles().PAGES_TITLE),Z.accHdrBpelTitle=o.observable(d.appTitles().BPEL_TITLE),Z.accHdrK8sTitle=o.observable(d.appTitles().K8S_TITLE),Z.getCanvas=function(){return j},Z.getCanvasTh=function(){return J},Z.getCanvasContext=function(){return q},Z.getCanvasContainer=function(){return X},Z.flowManager=new p(Z),Z.interactor=Z.flowManager.getMouseInteractor(),Z.dndHandler=Z.flowManager.getDnDHandler(),Z.updateTrigger=o.observable(!1);var ae=new m(Z);Z.getFlowManager=function(){return Z.flowManager};var se=new A(Z),re=Date.now(),le=!1,de=!!r.isDemoOnly();Z.isConnectionOK=o.observable(le),Z.cnxResultOK=function(){console.log("*** connection OK!!!")},Z.cnxResultFAIL=function(e){console.log("*** connection FAIL: "+e.readyState+", __cnxOK="+le),Date.now()-re<3e3?(le=!1,Z.showOverlayMessage("No server connection",500)):(le=!0,Z.showOverlayMessage("Connected",500)),Z.isConnectionOK(le),de=!0,setTimeout(function(){console.log("*** connection: "+le),Z.updateWindow()},200)},Z.initOK=function(){return de},e(document).ready(function(){function t(t){return e("<img>",{style:"margin: 0 6px -2px -22px;",src:c.getIconURL(t.value)})}function n(t){return e("<img>",{style:"margin: 0 6px -2px 0;",src:c.getIconURL(t.value)})}q.canvas.width=0,q.canvas.height=0,f.initDialog(Z.flowManager),v.initDialog(Z.flowManager),w.initDialog(Z.flowManager),E.initDialog(Z.flowManager),L.initDialog(Z.flowManager),F.initDialog(Z.flowManager),I.initDialog(Z.flowManager),N.initDialog(Z.flowManager),D.initDialog(Z.flowManager),h.initDialog(Z.flowManager),M.initDialog(Z.flowManager),T.initDialog(Z.flowManager),y.initDialog(Z.flowManager),C.initDialog(Z.flowManager),s.initButtons(Z),l.initActions(Z),k.initButtons(Z),e("#canvasId").contextmenu(Z.interactor.getContextMenu()),Q.addEventListener("mousemove",function(t){Z.interactor.isOverCanvas(t)||(e("#canvasId").contextmenu("close"),Z.flowManager.getFlowDiagram().setMousePoint(void 0))}),Q.addEventListener("mousedown",function(e){}),e("#paletteCtrId").show(),e("#paletteAccordionId").accordion({heightStyle:"fill",activate:function(e,t){t.newHeader.context.innerText===Z.accHdrDemoTitle()?B(d.appMode().FLOW_MODE):t.newHeader.context.innerText===Z.accHdrPagesTitle()&&B(d.appMode().PAGE_MODE),Z.updateWindow()}}),e("#paletteAccordionId").accordion("option","icons",{header:null,headerSelected:null}),e("#settingsTabId").tabs({}),e("#integrationTabId").tabs({}),e("#nodePropsTabId").tabs({activate:function(t,n){1===n.newTab.index()?e("#nodePropsTabId").css({overflow:"auto"}):e("#nodePropsTabId").css({overflow:"hidden"})}}),e("#infoTextId").attr("visibility","hidden"),G.spinner({step:1,min:d.canvasRange().MIN,max:d.canvasRange().MAX,numberFormat:"n"}),G.spinner("value",d.initial().LEVELS),G.spinner("enable"),Y.spinner({step:1,min:d.canvasRange().MIN,max:d.canvasRange().MAX,numberFormat:"n"}),Y.spinner("value",d.initial().LANES),Y.spinner("enable");var o=e("#progressBarId");o.progressbar({value:!1}),o.height(14),e.widget("nodeIcons.iconselectmenu",e.ui.selectmenu,{_renderButtonItem:function(t){var o=e("<div>",{text:c.getIconLabel(t.value)});return n(t).prependTo(o),o},_renderItem:function(n,o){var i=e("<li>"),a=e("<div>",{text:c.getIconLabel(o.value)});return t(o).prependTo(a),i.append(a).appendTo(n)},_renderMenu:function(t,n){var o=this,i=c.getOptionItems(n);e.each(i,function(e,n){o._renderItemData(t,n)})},refreshButtonItem:function(e,t){var n=c.getIndexValue(e,t);this.element[0].selectedIndex=n,this.refresh()}}),e("#nodeIconItemsId").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons customicons"),e("#settingIconItemsId").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons customicons"),e.widget("settings.schememenu",e.ui.selectmenu,{_renderButtonItem:function(t){return e("<div>",{text:"Default"})}}),e("#settingSchemesId").schememenu().schememenu("menuWidget").addClass("ui-menu-icons schememenu"),e("#selectPartitionId").selectmenu({select:function(e,t){if(e.currentTarget){var n=e.currentTarget.textContent;console.log("$$$ disk select: "+n),Z.selectedPartition(n)}},change:function(e,t){var n=e.currentTarget.textContent;console.log("### disk change: "+n)},create:function(e,t){setTimeout(function(){Z.flowManager.getDiskNames()},1e3)}}).addClass("settingsDiskMenu").css("fontSize","16px"),e("#selectFileTypeId").selectmenu({create:function(t,n){setTimeout(function(){Z.selectedFileType(d.fileTypes().JSON),e("#selectFileTypeId").selectmenu("refresh")},1e3)},select:function(e,t){if(e.currentTarget){var n=e.currentTarget.textContent;Z.selectedFileType(n),Z.flowManager.getDirContent()}}}).addClass("settingsDiskMenu"),e.widget("demomenu.demofilesmenu",e.ui.selectmenu,{_renderButtonItem:function(t){return e("<div>",{text:t.label?t.label:Z.flowManager.getDemoList()[0].label})}}),e("#selectFileId").demofilesmenu().demofilesmenu("menuWidget").addClass("ui-menu-icons demofiles")}),Z.isAutoLayoutAllowed=o.observable(r.isAllowAuto()),Z.forceTestAutoMode=function(e){r.setLayoutMode(d.layoutMode().AUTO),Z.flowManager.getSelectionManager().clearSelections(),Z.flowManager.resetScale(),Z.runTestAutoMode()},Z.resetTestAutoMode=function(){Z.flowManager.clearDiagram(),r.setLayoutMode(d.layoutMode().MANUAL)},Z.runTestAutoMode=function(){Z.flowManager.createDiagram("ReactDemo");var e=V.getJSONFile(),t={title:"React Demo",direction:2,startEnd:!0,swimLanes:!1},n=se.createLayout(e,t);console.log("Demo Flow: "+JSON.stringify(n,null,2)),Z.flowManager.adjustCanvas(),Z.flowManager.paintDiagram()},Z.nodeEmojiItems=o.pureComputed(function(){return c.getNodeIconOptions()}),Z.demoFilesItems=o.pureComputed(function(){return Z.flowManager.getDemoList()}),Z.isProgressBarVisible=o.observable(!1),Z.isProgressBarVisible.extend({notify:"always"}),Z.setProgressBarVisible=function(e){Z.isProgressBarVisible(e)},Z.showPageMode=o.observable(r.hasPageMode()),Z.isCanvasVisible=o.observable(!1),Z.setCanvasVisible=function(e){Z.isCanvasVisible(e)},Z.scaleValue=o.observable(r.getScale());var ue=document.getElementById("scaleId");ue.oninput=function(){r.setScale(this.value/d.scale().FACTOR),Z.scaleValue(r.getScale()),Z.flowManager.clearClipboard(),Z.flowManager.getFlowDiagram().clearCanvas(),Z.flowManager.paintDiagram()},ue.onchange=function(){Z.flowManager.refreshDiagramOnEdit()},Z.editModeText=o.observable(r.isEditMode()?d.editModeText().EDIT:d.editModeText().VIEW),Z.setEditModeText=function(e){e===d.editMode().EDIT_ALL?Z.editModeText(d.editModeText().EDIT):Z.editModeText(d.editModeText().VIEW)},Z.setTooltipBox=function(e,t){e.length>0&&r.isEditMode()&&S.drawTooltip(q,j.getBoundingClientRect(),t,e)},Z.showTooltipBox=function(e){},Z.getCurrentFileName=function(){var e=Z.flowManager.getFileName(),t=e.indexOf(".json");return e.substring(0,t)};var ce,ge=document.getElementById("blockResizeId"),pe=e("#extendBlockAcrossId"),me=e("#extendBlockAlongId"),be=e("#shrinkBlockAcrossId"),fe=e("#shrinkBlockAlongId");Z.showBlockResizeBar=function(e){var t=e.getExpandedShape(),n=r.getScale();ge.style.left=j.getBoundingClientRect().left+t.x*n+"px",ge.style.top=j.getBoundingClientRect().top+t.y*n-24+"px",pe.attr("disabled",!r.isEditMode()||!e.canExtendAcross()),me.attr("disabled",!r.isEditMode()||!e.canExtendAlong()),be.attr("disabled",!r.isEditMode()||!e.canShrinkAcross()),fe.attr("disabled",!r.isEditMode()||!e.canShrinkAlong()),ge.style.visibility="visible"},Z.doResizeContainer=function(e){var t=Z.getFlowManager().getSelectionManager().getSelections();t[0].getFlowType()===d.flowType().CONTAINER&&t[0].resizeOutline(e),ge.style.visibility="hidden",ce=!1},Z.isBlockResizeBarVisible=function(){return ce},Z.hideContainerBar=function(){ge.style.visibility="hidden"};var ve,we=document.getElementById("switchResizeId"),Ie=e("#extendSwitchAcrossId"),Ne=e("#shrinkSwitchAcrossId");Z.showSwitchResizeBar=function(e){var t=e.getMenuBarPosition(),n=r.getScale();we.style.left=j.getBoundingClientRect().left+t.x*n+"px",we.style.top=j.getBoundingClientRect().top+t.y*n-24+"px",Ie.attr("disabled",!r.isEditMode()||!e.canExtendAcross()),Ne.attr("disabled",!r.isEditMode()||!e.canShrinkAcross()),we.style.visibility="visible"},Z.doResizeSwitch=function(e){var t=Z.getFlowManager().getSelectionManager().getSelections();t[0].getFlowType()===d.flowType().SWITCH&&t[0].resizeOutline(e),we.style.visibility="hidden",ve=!1},Z.isSwitchResizeBarVisible=function(){return ve},Z.hideSwitchBar=function(){we.style.visibility="hidden"},Z.showSearchList=o.observable(!1),Z.showFindOptions=o.observable(!0),Z.searchContentList=o.observableArray(),Z.foundMatches=o.observable(),Z.onFindTableClick=function(e){var t=e.target.innerText;D.selectedNewDisk(t)},Z.onFindTableDblClick=function(e){Z.onFindTableClick(e)},Z.onPasteSearchText=function(e){D.selectedNewDisk(label)},Z.currentPath=o.observable(),Z.fsContentList=o.observableArray(),Z.selectedPath=o.observable(),Z.isOpenMode=o.observable(),Z.isSaveMode=o.observable(),Z.showPartitions=o.observable(!1),Z.partitionsList=o.observableArray([""]),Z.selectedPartition=o.observable("D:"),Z.filesTypes=o.observableArray([d.fileTypes().JSON,d.fileTypes().ALL]),Z.selectedFileType=o.observable(d.fileTypes().JSON);Z.callOpenFlowDialog=function(){Z.isConnectionOK()?$.dialog({height:440}):$.dialog({height:180}),$.dialog("open")},Z.onDiskTableClick=function(e){var t=e.target.innerText;w.selectedNewDisk(t)},Z.setFSDialogMode=function(e){ae.setFSDialogMode(e)},Z.getFSDialogMode=function(){return ae.getFSDialogMode()},Z.restoreWorkDir=function(){ae.restoreWorkDir()},Z.setWorkDir=function(e){ae.setWorkDir(e)},Z.getWorkDir=function(){return ae.getWorkDir()},Z.getSelectedFSDir=function(){return ae.getSelectedFSDir()},Z.getSelectedFSFile=function(){return ae.getSelectedFSFile()},Z.onDirTableClick=function(e){ae.onDirTableClick(e)},Z.deleteFSItem=function(){ae.deleteFSItem()},Z.onDirTableDblClick=function(e){ae.onDirTableDblClick(e)},Z.updateMainFSLocation=function(){ae.updateMainFSLocation()},Z.goOneDirBack=function(){ae.goOneDirBack()},Z.setDirsList=function(e,t){ae.setDirsList(e,t)},Z.setFolderContent=function(e,t){ae.setFolderContent(e,t)},Z.onFileTypeChange=function(e){ae.onFileTypeChange(e)},Z.settingsSchemes=o.observableArray(["Default"]),Z.selectedScheme=o.observable("Default"),Z.onSchemeChange=function(e){Z.selectedScheme().split(".").pop()};var De;Z.setNewAction=function(e){De=e},Z.isNewAction=function(){return De},Z.filesList=o.observableArray();var he=[];Z.setFilesList=function(t){if(he=t,Z.filesList(t),Z.filesList(filterFilesList(t)),De)e("#newFlowDialogId").dialog("open");else;},Z.selectedFile=o.observable(),Z.getSelectedFile=function(){return Z.isConnectionOK()?_selectedFile:Z.selectedFile()},Z.isInputInvalid=o.observable(!1),Z.validateMessage=o.observable(""),Z.newFSNameValue=o.observable(""),Z.nameValueEmpty=o.observable(""),Z.validateFSName=function(t,n){var o=Z.newFSNameValue().trim(),i=n?a.getDirectoriesLabels():Z.filesList();Z.nameValueEmpty(0===o.length);var s=Z.isInputInvalid(),r=O.containsFSName(i,o),l=O.isFSNameValid(Z.newFSNameValue()),d=o.length>0&&(!l||r);Z.isInputInvalid(d),s&&!d&&(e("#newFileNameId").blur(),e("#newFileNameId").focus()),e("#newFlowButtonOK").button("option","disabled",Z.isInputInvalid()||Z.nameValueEmpty()),e("#newFolderButtonOK").button("option","disabled",Z.isInputInvalid()||Z.nameValueEmpty()),l?r?Z.validateMessage("Duplicate name"):Z.validateMessage(""):Z.validateMessage("Only alphanumeric characters, dots, dashes, and underscores"),t&&o.length>0&&l&&"Enter"===t.code&&(De?(f.createNewDiagram(Z.flowManager),e("#newFlowDialogId").dialog("close")):(v.createNewFolder(Z.flowManager),e("#newFolderDialogId").dialog("close")))},e("#newFlowDialogId").on("dialogopen",function(e,t){Z.validateFSName()}),e("#newFlowDialogId").on("dialogclose",function(e,t){Z.newFSNameValue("")}),Z.saveAsInputInvalid=o.observable(!1),Z.saveAsMessage=o.observable(""),Z.saveAsFileNameValue=o.observable(""),Z.saveAsNameEmpty=o.observable(""),Z.validateSaveAsFileName=function(t){var n=Z.saveAsFileNameValue().trim();Z.saveAsNameEmpty(0===n.length);var o=Z.saveAsInputInvalid(),i=n!==Z.getCurrentFileName()&&O.containsFSName(Z.filesList(),n),a=O.isFSNameValid(Z.saveAsFileNameValue()),s=n.length>0&&(!a||i);Z.saveAsInputInvalid(s),o&&!s&&(e("#saveAsFileNameId").blur(),e("#saveAsFileNameId").focus()),e("#saveAsButtonSave").button("option","disabled",Z.saveAsInputInvalid()||Z.saveAsNameEmpty()),a?i?Z.saveAsMessage("Duplicate name"):Z.saveAsMessage(""):Z.saveAsMessage("Only alphanumeric characters, dots, dashes, and underscores"),n.length>0&&a&&t.code};var Me=o.observable();Z.propsLinkSourceName=o.observable(),Z.propsLinkSourceLabel=o.observable(),Z.propsLinkTargetName=o.observable(),Z.propsLinkTargetLabel=o.observable(),Z.propsLinkLabel=o.observable(),Z.getPropsLink=function(){return Me()},Z.getPropsLinkLabelValue=function(){return Z.propsLinkLabel()},Z.showLinkProps=function(t){Me(t),Z.propsLinkSourceName(Me().getLinkSourcePortName()),Z.propsLinkSourceLabel(Me().getLinkSourcePortLabel()),Z.propsLinkTargetName(Me().getLinkTargetPortName()),Z.propsLinkTargetLabel(Me().getLinkTargetPortLabel()),Z.propsLinkLabel(Me().getLinkLabel()),e("#linkPropsDialogId").dialog("open")},Z.editPropsLinkLabel=function(e){Z.propsLinkLabel(document.getElementById("propsLinkLabelId").value)},Z.propsNodeInputs=o.observableArray();var Te,ye;Z.getPropsNodeInputsIdx=function(){return Te},Z.getPropsNodeInputsValue=function(){return ye},Z.propsNodeOutputs=o.observableArray();var Ce,Ee;Z.getPropsNodeOutputsIdx=function(){return Ce},Z.getPropsNodeOutputsValue=function(){return Ee},Z.propsNodeRefInputs=o.observableArray();var Le,Fe;Z.getPropsNodeRefInputsIdx=function(){return Le},Z.getPropsNodeRefInputsValue=function(){return Fe},Z.propsNodeRefOutputs=o.observableArray();var ke,xe;Z.getPropsNodeRefOutputsIdx=function(){return ke},Z.getPropsNodeRefOutputsValue=function(){return xe};var Oe=o.observable();Z.getPropsNode=function(){return Oe()},Z.showNodeProps=function(t){Oe(t),c.setNodeCategory(t.getNodeCategory()),Z.propsNodeInputs(Oe().getInputPortsFullNames()),Z.propsNodeOutputs(Oe().getOutputPortsFullNames()),Z.propsNodeRefInputs(Oe().getRefInPortsFullNames()),Z.propsNodeRefOutputs(Oe().getRefOutPortsFullNames()),e("#nodePropsDialogId").dialog("open")},Z.editPropsNodeInputLabel=function(e){Te=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeInputsTableId"),n=t.getElementsByTagName("tr");ye=n[Te].cells[1].getElementsByTagName("input")[0].value},Z.editPropsNodeOutputLabel=function(e){Ce=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeOutputsTableId"),n=t.getElementsByTagName("tr");Ee=n[Ce].cells[1].getElementsByTagName("input")[0].value},Z.editPropsNodeRefInputLabel=function(e){Le=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeRefInputsTableId"),n=t.getElementsByTagName("tr");Fe=n[Le].cells[1].getElementsByTagName("input")[0].value},Z.editPropsNodeRefOutputLabel=function(e){ke=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeRefOutputsTableId"),n=t.getElementsByTagName("tr");xe=n[ke].cells[1].getElementsByTagName("input")[0].value},Z.isEditNameInvalid=o.observable(!1),Z.editNameValue=o.observable(""),Z.validateNameMessage1=o.observable(""),Z.validateNameMessage2=o.observable("");var Se;Z.setOldName=function(e){Se=e},Z.validateEditName=function(e){var t=Z.editNameValue().trim();if(t.length>0){var n=O.getAllNames(Z.flowManager.getNodeNamesMap()),o=t===Se||O.isNewNodeNameValid(t,n);Z.isEditNameInvalid(!o)}else Z.isEditNameInvalid(!0);o?(Z.validateNameMessage1(""),Z.validateNameMessage2("")):(Z.validateNameMessage1("Only alphanumericals, dots, dashes "),Z.validateNameMessage2("and underscores"))},Z.isLinkLabelInvalid=o.observable(!1),Z.validateLinkMessage=o.observable("");var Pe;Z.setOldLinkLabel=function(e){Pe=e},Z.validateLinkLabel=function(e){var t=Z.propsLinkLabel().trim();if(t.length>0){var n=O.getAllLinkLabels(Z.flowManager.getLinkLabelsMap()),o=t===Pe||O.isNewLinkLabelValid(t,n);Z.isLinkLabelInvalid(!o)}else Z.isLinkLabelInvalid(!1);o?Z.validateLinkMessage(""):Z.validateLinkMessage("Only alphanumericals, dots, dashes, underscores and spaces")},Z.pictureURLValue=o.observable(""),Z.isPictureURLInvalid=o.observable(!1),Z.validatePictureURL=function(e){Z.isPictureURLInvalid(!1)};var Ae=d.decisionRun().NONE,Ve=void 0;Z.showNewFileName=o.observable(),Z.showEditedInfo=o.observable(),Z.showDecisionInfo=o.observable(),Z.decisionInputPicture=o.observable(),Z.decisionEndsPicture=o.observable(),Z.isNodeNameInvalid=o.observable(!1),Z.newNodeNameValue=o.observable(""),Z.invalidNameMessage=o.observable(""),Z.newDecisionInput=o.observable(g.getCurrentDecisionInput()),Z.newDecisionEnds=o.observable(g.getCurrentDecisionEnds()),Z.editedDecisionNodeName=o.observable("???"),Z.setDecisionRun=function(e,t){if(Ae=t,t===d.decisionRun().CREATE){var n=P.getSelectedFlowType();Z.showNewFileName(!0),Z.showEditedInfo(!1),Z.showDecisionInfo(n===d.flowType().DECISION)}else t===d.decisionRun().EDIT&&(Ve=e,g.setCurrentInput(e.getInput()),g.setCurrentEnds(e.getEnds()),Z.editedDecisionNodeName(e.getName()),Z.newDecisionInput(g.getCurrentDecisionInput()),Z.newDecisionEnds(g.getCurrentDecisionEnds()),Z.decisionInputPicture(g.getCurrentInputPicture()),Z.decisionEndsPicture(g.getCurrentEndsPicture()),Z.showNewFileName(!1),Z.showEditedInfo(!0),Z.showDecisionInfo(!0))},Z.getEditedDecisionNode=function(){return Ve},Z.getDecisionRun=function(){return Ae},Z.validateNodeName=function(t){var n=Z.newNodeNameValue().trim();P.getSelectedFlowType();if(n.length>0){var o=O.isNodeNameValid(n),i=O.getAllNames(Z.flowManager.getNodeNamesMap()),a=O.isNodeNameDuplicate(n,i);if(Z.isNodeNameInvalid(!o||a),o&&!a&&"Enter"===t.code)return I.proceed(Z.flowManager),void e("#newNodeDialogId").dialog("close")}e("#newNodeButtonOK").button("option","disabled",Z.isNodeNameInvalid()||0==n.length),o?a?Z.invalidNameMessage("Duplicate name"):Z.invalidNameMessage(""):Z.invalidNameMessage("Only alphanumeric characters, dots, dashes, and underscores")},Z.getDecisionIcon=function(){return Z.updateTrigger(!Z.updateTrigger()),g.getDecisionIcon()},Z.resetDecisionIndices=function(){Z.updateTrigger(!Z.updateTrigger()),g.resetCurrentInputIndex(),g.resetCurrentEndsIndex(),Z.decisionInputPicture(g.getCurrentInputPicture()),Z.decisionEndsPicture(g.getCurrentEndsPicture()),Z.newDecisionInput(g.getCurrentDecisionInput()),Z.newDecisionEnds(g.getCurrentDecisionEnds())},Z.moveDecisionInputNext=function(){Z.updateTrigger(!Z.updateTrigger()),g.moveInputNext(),Z.newDecisionInput(g.getCurrentDecisionInput()),Z.decisionInputPicture(g.getCurrentInputPicture()),Z.decisionEndsPicture(g.getCurrentEndsPicture());var t=Z.newNodeNameValue().trim();Z.editedDecisionNodeName(z()),e("#newNodeButtonOK").button("option","disabled",Z.getDecisionRun()!==d.decisionRun().EDIT&&(Z.isNodeNameInvalid()||0==t.length))},Z.moveDecisionInputPrev=function(){Z.updateTrigger(!Z.updateTrigger()),g.moveInputPrevious(),Z.newDecisionInput(g.getCurrentDecisionInput()),Z.decisionInputPicture(g.getCurrentInputPicture()),Z.decisionEndsPicture(g.getCurrentEndsPicture());var t=Z.newNodeNameValue().trim();Z.editedDecisionNodeName(z()),e("#newNodeButtonOK").button("option","disabled",Z.getDecisionRun()!==d.decisionRun().EDIT&&(Z.isNodeNameInvalid()||0==t.length))},Z.moveDecisionEndsNext=function(){Z.updateTrigger(!Z.updateTrigger()),g.moveEndsNext(),Z.newDecisionEnds(g.getCurrentDecisionEnds()),Z.decisionEndsPicture(g.getCurrentEndsPicture());var t=Z.newNodeNameValue().trim();Z.editedDecisionNodeName(z()),e("#newNodeButtonOK").button("option","disabled",Z.getDecisionRun()!==d.decisionRun().EDIT&&(Z.isNodeNameInvalid()||0==t.length))},Z.moveDecisionEndsPrev=function(){Z.updateTrigger(!Z.updateTrigger()),g.moveEndsPrevious(),Z.newDecisionEnds(g.getCurrentDecisionEnds()),Z.decisionEndsPicture(g.getCurrentEndsPicture());var t=Z.newNodeNameValue().trim();Z.editedDecisionNodeName(z()),e("#newNodeButtonOK").button("option","disabled",Z.getDecisionRun()!==d.decisionRun().EDIT&&(Z.isNodeNameInvalid()||0==t.length))},Z.btnFlowH2click=function(){Z.changeFlowDirection(d.flow().VERTICAL)},Z.btnFlowV2click=function(){Z.changeFlowDirection(d.flow().HORIZONTAL)},Z.changeFlowDirection=function(e){W(e)},Z.isHorizontal=o.observable(!1),Z.layoutModeText=o.observable(r.getLayoutModeText()),Z.diagramModeText=o.observable(r.getDiagramModeText());var Re=e("#newId"),Be=e("#openId"),He=e("#undoId"),Ke=e("#redoId"),ze=e("#findId"),We=e("#refreshId"),_e=e("#clearId"),Ue=e("#leftId"),Ze=e("#rightId"),je=e("#deleteId"),Je=e("#copyId"),qe=e("#pasteId"),Xe=e("#saveId"),Qe=e("#saveAsId"),$e=e("#btnFlowVId");e("#btnThumbnailId");Z.updateWindow=function(t){Z.updateTrigger(!Z.updateTrigger()),Z.isHorizontal(r.getFlowDirection()===d.flow().HORIZONTAL),Z.layoutModeText(r.getLayoutModeText()),Z.diagramModeText(r.getDiagramModeText());var n=!r.isEditMode();s.updateMenus(Z),Re.attr("disabled",n||!Z.isConnectionOK()&&!Z.initOK()),Be.attr("disabled",!Z.isConnectionOK()&&!Z.initOK()),He.attr("disabled",n||!Z.flowManager.canUndo()).attr("title",Z.flowManager.getUndoName()),Ke.attr("disabled",n||!Z.flowManager.canRedo()).attr("title",Z.flowManager.getRedoName()),je.attr("disabled",n||!Z.flowManager.getSelectionManager().hasSelections()),Je.attr("disabled",n||!Z.flowManager.canCopy()),qe.attr("disabled",n||!Z.flowManager.readyToPaste()),Xe.attr("disabled",n||!Z.isConnectionOK()||!Z.flowManager.isDirty()),Qe.attr("disabled",n||!Z.isConnectionOK()||Z.flowManager.getModelHandler().isDiagramEmpty()),We.attr("disabled",!Z.isCanvasVisible()),ze.attr("disabled",!Z.isCanvasVisible()),_e.attr("disabled",n||!Z.isCanvasVisible()),Ue.attr("disabled",!Z.flowManager.hasPreviousDiagram()),Ze.attr("disabled",!Z.flowManager.hasNextDiagram()),$e.attr("disabled",r.getAppMode()!==d.appMode().FLOW_MODE),e("#btnFlowHId").attr("disabled",n),e("#btnFlowVId").attr("disabled",n),"visible"!==document.getElementById("blockResizeId").style.visibility||ce?ce&&(document.getElementById("blockResizeId").style.visibility="hidden",ce=!1):ce=!0,"visible"!==document.getElementById("switchResizeId").style.visibility||ve?ve&&(document.getElementById("switchResizeId").style.visibility="hidden",ve=!1):ve=!0,Z.flowManager.isInitialResizeMode()&&Z.flowManager.getModelHandler().isDiagramEmpty()?(G.spinner("enable"),Y.spinner("enable")):(G.spinner("disable"),Y.spinner("disable"))};var Ge=!1;Z.hasFlowDirectionChange=function(){return Ge},Z.setFlowDirectionChange=function(){Ge=!0},Z.resetFlowDirectionChange=function(){Ge=!1},Z.initData=function(){Z.updateWindow()},Z.gallerySENodes=o.pureComputed(function(){return Z.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getSENodesH():u.getSENodesV()}),Z.galleryFlowNodes=o.pureComputed(function(){return Z.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getFlowNodesH():u.getFlowNodesV()}),Z.gallerySwimNodes=o.pureComputed(function(){return Z.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getSwimNodesH():u.getSwimNodesV()}),Z.galleryQuizNodes=o.pureComputed(function(){return Z.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getQuizNodesH():u.getQuizNodesV()}),Z.galleryMiscNodes=o.pureComputed(function(){return Z.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getMiscNodesH():u.getMiscNodesV()}),Z.pageNodes=o.pureComputed(function(){Z.updateTrigger();for(var e=[],t=r.getFlowDirection()===d.flow().HORIZONTAL?u.getHPageItems():u.getVPageItems(),n=0;n<t.length;n++)e.push(t[n]);return e}),Z.diagramDisplayName=o.observable(te),Z.setDiagramDisplayName=function(e){e&&e.length>0?Z.diagramDisplayName(e):Z.diagramDisplayName(te)},Z.aboutTitle=o.observable(""),Z.aboutVersion=o.observable(""),Z.aboutText=o.observable(""),Z.aboutSources=o.observable(""),Z.aboutCopyright=o.observable(""),Z.showAboutBox=function(t,n,o,i,a){Z.aboutTitle(t),Z.aboutVersion(n),Z.aboutText(o),Z.aboutSources(i),Z.aboutCopyright(a),e("#aboutDialogId").dialog("open")},Z.integrationTitle=o.observable(R.getTopTitle()),Z.integrationTopNotes=o.observable(R.getTopNotes()),Z.integrationReactTitle=o.observable(R.getReactTitle()),Z.integrationReactNotesTop=o.observable(R.getReactNotesTop()),Z.integrationReactNotesBottom=o.observable(R.getReactNotesBottom()),Z.integrationAngularTitle=o.observable(R.getAngularTitle()),Z.integrationAngularNotesTop=o.observable(R.getAngularNotesTop()),Z.infoMessage=o.observable(""),Z.infoMessageVisible=o.observable(),Z.showInfoMessage=function(t,n){Z.infoMessage(t),Z.infoMessageVisible(!1),e("#infoDialogId").dialog("open"),n&&e("#infoDialogId").dialog("option","title",n)},e("#infoDialogId").on("dialogopen",function(t,n){setTimeout(function(){Z.infoMessageVisible(!0),e("#infoTextId").scrollTop(0)},200)});var Ye=e("#text1ViewDialogId");Z.viewMessage1=o.observable(""),Z.viewMessage1Visible=o.observable(),Z.showText1ViewMessage=function(e,t){Ye.dialog("isOpen")&&Ye.dialog("close"),Z.viewMessage1(e),Z.viewMessage1Visible(!1),Ye.dialog("open"),t&&Ye.dialog("option","title",t)},Ye.on("dialogopen",function(t,n){setTimeout(function(){Z.viewMessage1Visible(!0),e("#text1ViewId").scrollTop(0)},100)});var et=e("#text2ViewDialogId");Z.viewMessage2=o.observable(""),Z.viewMessage2Visible=o.observable(),Z.showText2ViewMessage=function(e,t){et.dialog("isOpen")&&et.dialog("close"),Z.viewMessage2(e),Z.viewMessage2Visible(!1),et.dialog("open"),t&&et.dialog("option","title",t)},et.on("dialogopen",function(t,n){setTimeout(function(){Z.viewMessage2Visible(!0),e("#text2ViewId").scrollTop(0)},100)});var tt;Z.getConfirmFlag=function(){return tt},Z.setConfirmFlag=function(e){tt=e},Z.confirmMessage=o.observable(""),Z.showConfirmMessage=function(t,n,o){y.initDialog(Z.flowManager),Z.confirmMessage(t),n&&ee.dialog("option","title",n),o&&(e(e("button",ee.parent())[1]).text(o.first),e(e("button",ee.parent())[2]).text(o.second)),ee.dialog("open")},Z.isShowThumbnail=o.observable(),Z.btnThumbnailShow=function(){Z.isShowThumbnail(!0),e("#thumbnailDialogId").dialog("open"),Z.repaintDiagram()},Z.btnThumbnailHide=function(){Z.isShowThumbnail(!1),Z.repaintDiagram()},Z.overlayText=o.observable("");var nt=e("#saveOverlayId");Z.showOverlayMessage=function(e,t){var n=t||400;Z.overlayText(e),nt.show(),setTimeout(function(){nt.fadeOut(n)},n+200)};var ot;Z.getDraggedPaletteId=function(){return ot},Z.setDraggedPaletteId=function(e){ot=e},Z.onPaletteDragStart=function(e){ot=e.target.id,e.dataTransfer.setData("text",e.target.id)},Z.onPaletteDragEnd=function(e){var t=j.getBoundingClientRect();e.clientX>t.left&&e.clientX<t.right&&e.clientY>t.top&&e.clientY<t.bottom||Z.flowManager.getDnDHandler().resetDrag()},Z.requestFocus=function(){},Z.isControlPressed=function(){return ne},Z.setControlPressed=function(e){ne=e},Z.isEditControlPressed=function(){return ie},Z.setEditControlPressed=function(e){ie=e},Z.isShiftPressed=function(){return oe},Z.setShiftPressed=function(e){oe=e},window.onresize=_,window.onscroll=function(){e("#thumbnailDialogId").dialog({position:{my:"right bottom",at:"right-17 bottom-4",of:window}}),e("#findDialogId").dialog({position:{my:"right top",at:"right-4 top-4",of:window}}),Z.repaintDiagram()};var it=0,at=e("#containerId");return Z.repaintDiagram=function(){Z.hideContainerBar(),Z.hideSwitchBar(),Z.flowManager.paintDiagram()},o.applyBindings(Z),Z.initData(),{initFlowDemo:function(){window.scrollTo(0,0),e(window).trigger("resize"),Z.setProgressBarVisible(!1),r.isDemoOnly()?(Z.isConnectionOK(!1),Z.showOverlayMessage("No server connection",500),Z.updateWindow()):r.isDevMode()?(Z.isConnectionOK(!0),Z.updateWindow()):(Z.showOverlayMessage("Connecting to server...",3e3),i.checkMyConnection(Z.flowManager))}}});