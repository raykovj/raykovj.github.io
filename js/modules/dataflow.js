define(["jquery","jqueryui","jqueryuictxm","knockout","modules/server/ioHandler","modules/fs/directories","modules/html/toolbar","modules/settings/config","modules/actions/frameActions","modules/graph/graphConstants","modules/gallery/components","modules/gallery/iconOptionsPicker","modules/gallery/portIconPicker","modules/gallery/cardinalityPicker","modules/gallery/decisionEnds","modules/erd/dbRecords","modules/flow/flowManager","modules/fs/fsBrowser","modules/diagram/mouseInteractor","modules/dialogs/newFlowDialog","modules/dialogs/newFolderDialog","modules/dialogs/openFlowDialog","modules/dialogs/createNodeDialog","modules/dialogs/nodePropsDialog","modules/dialogs/findDialog","modules/dialogs/linkPropsDialog","modules/dialogs/aboutDialog","modules/util/welcomeText","modules/dialogs/welcomeDialog","modules/dialogs/infoDialog","modules/dialogs/confirmDialog","modules/dialogs/thumbnailDialog","modules/settings/settingsDialog","modules/geometry/point","modules/util/utils","modules/draw/draw","modules/controller/flowCache","modules/exportLayout/demoFlow","modules/util/integrationText"],function(e,t,n,i,o,a,s,r,l,d,u,c,g,p,m,b,v,f,I,h,w,T,D,N,y,C,L,E,k,M,F,x,S,P,R,A,O,B,V){function H(e){e===d.flow().VERTICAL?(me.removeClass("block-extendV"),me.addClass("block-extendH"),be.removeClass("block-extendH"),be.addClass("block-extendV"),ve.removeClass("block-shrinkV"),ve.addClass("block-shrinkH"),fe.removeClass("block-shrinkH"),fe.addClass("block-shrinkV")):e===d.flow().HORIZONTAL&&(me.removeClass("block-extendH"),me.addClass("block-extendV"),be.removeClass("block-extendV"),be.addClass("block-extendH"),ve.removeClass("block-shrinkH"),ve.addClass("block-shrinkV"),fe.removeClass("block-shrinkV"),fe.addClass("block-shrinkH"))}function W(e){e===d.flow().VERTICAL?(we.removeClass("block-extendV"),we.addClass("block-extendH"),Te.removeClass("block-shrinkV"),Te.addClass("block-shrinkH")):e===d.flow().HORIZONTAL&&(we.removeClass("block-extendH"),we.addClass("block-extendV"),Te.removeClass("block-shrinkH"),Te.addClass("block-shrinkV"))}function _(e){if(X.selectedFileType()===d.fileTypes().ALL)return e;var t=[],n=X.selectedFileType().split(".").pop();return e.forEach(function(e){e.split(".").pop()===n&&t.push(e)}),t}function K(){e("#openSaveButtonOK").button("option","disabled",X.isFlowSaveBlocked())}function z(){return Be?Be.getName():"[none]"}function U(e){r.setFlowDirection(e),X.setFlowDirectionChange(),H(e),W(e),X.getFlowManager().hasDiagramOpen()&&X.manager.setDirty(!0),X.setConfirmFlag(d.bValue().FALSE),X.getFlowManager().setSettingsChanged(!0),setTimeout(function(){X.getFlowManager().refreshDiagramOnEdit(!0)},200)}function Z(){var e=E.getTitle(),t=E.getWelcome(),n=E.getWelcomeTo(),i=E.getText();X.showWelcomeBox(e,t,n,i)}function j(){var e=document.getElementById("containerId").clientWidth;G.width>e&&r.hasShowBottomMessages()&&X.showBottomMessage("Drag the mouse on canvas to scroll")}function q(){var t=e(window).height();e(window).scrollTop();ot.height(t-it)}var X=this,G=document.getElementById("canvasId"),J=document.getElementById("canvasThId"),$=G.getContext("2d"),Y=document.getElementById("containerId"),Q=document.getElementById("topContainerId"),ee=e("#openFlowDialogId"),te=e("#spinnerLevelsId"),ne=e("#spinnerLanesId"),ie=(e("#spinnerSpaceId"),e("#confirmDialogId")),oe=(e("#thumbnailDialogId"),document.getElementById("scaleId")),ae="[select 'New' or 'Open' from menus]",se=!1,re=!1,le=!1;X.accHdrFlowTitle=i.observable(d.appTitles().FLOW_TITLE),X.accHdrSideTitle=i.observable(d.appTitles().SIDE_TITLE),X.accHdrMiscTitle=i.observable(d.appTitles().MISC_TITLE),X.accHdrERDTitle=i.observable(d.appTitles().ERD_TITLE),X.accHdrPagesTitle=i.observable(d.appTitles().PAGES_TITLE),X.accHdrBpelTitle=i.observable(d.appTitles().BPEL_TITLE),X.accHdrK8sTitle=i.observable(d.appTitles().K8S_TITLE),X.getCanvas=function(){return G},X.setCanvas=function(e){G=e},X.getCanvasContext=function(){return $},X.getCanvasTh=function(){return J},X.setCanvasTh=function(e){J=e},X.getCanvasContext=function(){return $},X.getCanvasContainer=function(){return Y},X.getTopContainer=function(){return Q},X.manager=new v(X),X.interactor=X.manager.getMouseInteractor(),X.dndHandler=X.manager.getDnDHandler(),X.updateTrigger=i.observable(!1);var de=new f(X);X.getFlowManager=function(){return X.manager};var ue=Date.now(),ce=!1;X.isConnectionOK=i.observable(ce),X.cnxResultOK=function(){ce=!0,X.showOverlayMessage("Connected",500),X.isConnectionOK(ce),setTimeout(function(){X.updateWindow()},200),ce&&X.manager.getInstallSettings(),Z()},X.cnxResultFAIL=function(e){Date.now()-ue<3e3?(ce=!1,console.log("*** connection FAIL: "+e.readyState),setTimeout(function(){X.showOverlayMessage("No server connection",500)},200)):(ce=!0,X.showOverlayMessage("Connected",500)),X.isConnectionOK(ce),setTimeout(function(){console.clear(),X.updateWindow()},200),ce&&X.manager.getInstallSettings(),Z()};X.isShowERD=i.observable(!1),e(document).ready(function(){function t(e){X.isDgmFlow(e)}function n(t){return e("<img>",{style:"margin: 0 6px -2px -22px;",src:c.getIconURL(t.value)})}function o(t){return e("<img>",{style:"margin: 0 6px -2px 0;",src:c.getIconURL(t.value)})}function a(t){return e("<img>",{style:"margin: 0px 6px 2px 10px; ",src:g.getPortIconURL(t.value)})}function u(t){return e("<img>",{style:"margin: 0 6px -2px 6px; background-color: white; }",src:g.getPortIconURL(t.value)})}function m(t){return e("<img>",{style:"margin: 0 6px -2px -22px;",src:p.getCardinalityURL(t.value)})}function b(t){return e("<img>",{style:"margin: 0 6px -2px 0;",src:p.getCardinalityURL(t.value)})}$.canvas.width=0,$.canvas.height=0,h.initDialog(X.manager),w.initDialog(X.manager),T.initDialog(X.manager),S.initDialog(X.manager),D.initDialog(X.manager),N.initDialog(X.manager),y.initDialog(X.manager),C.initDialog(X.manager),L.initDialog(X.manager),M.initDialog(X.manager),F.initDialog(X.manager),x.initDialog(X.manager),k.initDialog(X.manager),s.initButtons(X),l.initActions(X),e("#canvasId").contextmenu(X.interactor.getContextMenu()),Q.addEventListener("mousemove",function(t){X.interactor.isOverCanvas(t)||(e("#canvasId").contextmenu("close"),X.manager.getFlowDiagram().setMousePoint(void 0))}),e("#paletteAccordionId").accordion({heightStyle:"fill",animate:{easing:"swing",duration:200},collapsible:!0,create:function(t,n){e(".ui-accordion-header").css("background","#b5e0fd"),e(".ui-accordion-header.ui-state-active ").css("background","#408DEE")},activate:function(t,n){e(".ui-accordion-header").css("background","#b5e0fd"),e(".ui-accordion-header.ui-state-active ").css("background","#408DEE");n.newHeader.context&&n.newHeader.context.innerText;X.updateWindow()}}),setTimeout(function(){e("#paletteAccordionId").accordion("option","icons",{header:"ui-icon-triangle-1-e",activeHeader:"ui-icon-triangle-1-s"})},100),e("#accTableFlowId").height(210),e("#accTableMiscsId").height(132),e("#accTableERDId").height(210),e("#btnFlowId").prop("checked",!0),e('input[id="btnFlowId"]').on("change",function(e){r.setDiagramType(d.diagramType().FLOWCHART)}),e('input[id="btnERDId"]').on("change",function(e){r.setDiagramType(d.diagramType().ERD)}),X.isDgmFlow=i.observable(!1),e("#btnDgmModeDId").click(function(e,n){t(!0)}),e("#btnDgmModeUId").click(function(e,n){t(!1)}),X.hasDiagram=i.observable(!1),X.setDiagramOpen=function(e){X.hasDiagram(e)},e("#settingsTabId").tabs({}),e("#integrationTabId").tabs({}),e("#nodePropsTabId").tabs({activate:function(t,n){1===n.newTab.index()?e("#nodePropsTabId").css({overflow:"auto"}):e("#nodePropsTabId").css({overflow:"hidden"})}}),e("#infoTextId").attr("visibility","hidden"),te.spinner({step:1,min:d.canvasRange().MIN,max:d.canvasRange().MAX,numberFormat:"n"}),te.spinner("value",d.initial().LEVELS),te.spinner("enable"),ne.spinner({step:1,min:d.canvasRange().MIN,max:d.canvasRange().MAX,numberFormat:"n"}),ne.spinner("value",d.initial().LANES),ne.spinner("enable");var v=e("#progressBarId");v.progressbar({value:!1}),v.height(14),e.widget("nodeIcons.iconselectmenu",e.ui.selectmenu,{_renderButtonItem:function(t){var n=e("<div>",{text:c.getIconLabel(t.value)});return o(t).prependTo(n),n},_renderItem:function(t,i){var o=e("<li>"),a=e("<div>",{text:c.getIconLabel(i.value)});return n(i).prependTo(a),o.append(a).appendTo(t)},_renderMenu:function(t,n){var i=this,o=c.getOptionItems(n);e.each(o,function(e,n){i._renderItemData(t,n)})},refreshButtonItem:function(e,t){var n=c.getIndexValue(e,t);this.element[0].selectedIndex=n,this.refresh()}}),e("#nodeIconItemsId").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons customicons"),e("#settingIconItemsId").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons customicons"),e.widget("portImages.porticonmenu",e.ui.selectmenu,{_renderButtonItem:function(t){var n=e("<div>",{style:"padding-left: 16px; height: 16px; width: 100px; background-color: white"});return a(t).prependTo(n),n},_renderItem:function(t,n){var i=e("<li>"),o=e("<div>",{style:"height: 16px; width: 120px"});return u(n).prependTo(o),i.append(o).appendTo(t)},_renderMenu:function(t,n){var i=this,o=g.getPortOptionItems(n);e.each(o,function(e,n){i._renderItemData(t,n)})},refreshButtonItem:function(e){var t=g.getPortIndexValue(e);this.element[0].selectedIndex=t,this.refresh()}}),e("#selectPortIconsId").porticonmenu().porticonmenu("menuWidget").addClass("ui-menu-icons porticons"),e.widget("ports.portcardinalitymenu",e.ui.selectmenu,{_renderButtonItem:function(t){var n=e("<div>",{text:p.getCardinalityLabel(t.value)});return b(t).prependTo(n),n},_renderItem:function(t,n){var i=e("<li>"),o=e("<div>",{text:p.getCardinalityLabel(n.value)});return m(n).prependTo(o),i.append(o).appendTo(t)},_renderMenu:function(t,n){var i=this,o=p.getCardinalityItems(n);e.each(o,function(e,n){i._renderItemData(t,n)})},refreshButtonItem:function(e,t){var n=p.getCardinalityIndex(e,t);this.element[0].selectedIndex=n,this.refresh()}}),e("#selectPartitionId").selectmenu({select:function(e,t){if(e.currentTarget){var n=e.currentTarget.textContent;console.log("$$$ disk select: "+n),X.selectedPartition(n)}},change:function(e,t){var n=e.currentTarget.textContent;console.log("### disk change: "+n)},create:function(e,t){setTimeout(function(){X.manager.getDiskNames()},1e3)}}).addClass("settingsDiskMenu").css("fontSize","16px"),e("#selectFileTypeId").selectmenu({create:function(t,n){setTimeout(function(){X.selectedFileType(d.fileTypes().JSON),e("#selectFileTypeId").selectmenu("refresh")},1e3)},select:function(e,t){if(e.currentTarget){var n=e.currentTarget.textContent;X.selectedFileType(n),X.manager.getDirContent()}}}).addClass("settingsDiskMenu"),e.widget("demomenu.demofilesmenu",e.ui.selectmenu,{_renderButtonItem:function(t){return e("<div>",{text:t.label?t.label:X.manager.getDemoList()[0].label})}}),e("#selectFileId").demofilesmenu().demofilesmenu("menuWidget").addClass("ui-menu-icons demofiles")}),X.isAutoLayoutAllowed=i.observable(r.isAllowAuto()),X.forceTestAutoMode=function(e){r.setLayoutMode(d.layoutMode().AUTO),X.manager.getSelectionManager().clearSelections(),X.manager.resetScale(),X.runTestAutoMode()},X.resetTestAutoMode=function(){X.manager.clearDiagram(),r.setLayoutMode(d.layoutMode().MANUAL)},X.runTestAutoMode=function(){},X.nodeEmojiItems=i.pureComputed(function(){return c.getNodeIconOptions()}),X.portIcons=i.pureComputed(function(){return g.getPortIconOptions()}),X.cardinalityItems=i.pureComputed(function(){return p.getCardinalityList()}),X.enableShowCardinality=i.observable(!1),X.setEnableShowCardinality=function(e){X.enableShowCardinality(e)},X.enableShowDB=i.observable(!1),X.setEnableShowDB=function(e){X.enableShowDB(e)},X.demoFilesItems=i.pureComputed(function(){return X.manager.getDemoList()}),X.nodeActionsList=i.pureComputed(function(){return N.getActionsList()}),X.nodeOperationsList=i.pureComputed(function(){return N.getOperationsList()}),X.nodeServicesList=i.pureComputed(function(){return N.getServicesList()}),X.nodePublishList=i.pureComputed(function(){return N.getPublishList()}),X.nodeSubscribeList=i.pureComputed(function(){return N.getSubscribeList()}),X.onOpsActionChange=function(e){},X.isProgressBarVisible=i.observable(!1),X.isProgressBarVisible.extend({notify:"always"}),X.setProgressBarVisible=function(e){X.isProgressBarVisible(e)},X.showPageMode=i.observable(r.hasPageMode()),X.isCanvasVisible=i.observable(!1),X.setCanvasVisible=function(e){X.isCanvasVisible(e)},X.scaleValue=i.observable(r.getScale()),e("#scaleId").slider(),oe.oninput=function(){r.setScale(this.value/d.scale().FACTOR),X.scaleValue(r.getScale()),X.manager.clearClipboard(),X.manager.getFlowDiagram().clearCanvas(),X.manager.rebuildFlowData()},X.editModeText=i.observable(r.isEditMode()?d.editModeText().EDIT:d.editModeText().VIEW),X.setEditModeText=function(e){e===d.editMode().EDIT_ALL?X.editModeText(d.editModeText().EDIT):X.editModeText(d.editModeText().VIEW)},X.setTooltipBox=function(e,t){e.length>0&&r.isEditMode()&&1===r.getScale()&&A.drawTooltip($,G.getBoundingClientRect(),t,e)},X.showTooltipBox=function(e){},X.getCurrentShortFileName=function(){var e=X.manager.getFileName(),t=e.indexOf(".json"),n=e.substring(0,t),i=n.lastIndexOf("/");return n.substring(i+1)};var ge,pe=document.getElementById("blockResizeId"),me=e("#extendBlockAcrossId"),be=e("#extendBlockAlongId"),ve=e("#shrinkBlockAcrossId"),fe=e("#shrinkBlockAlongId");X.showBlockResizeBar=function(e){var t=e.getExpandedShape(),n=r.getScale();pe.style.left=G.getBoundingClientRect().left+t.x*n+"px",pe.style.top=G.getBoundingClientRect().top+t.y*n-24+"px",me.attr("disabled",!r.isEditMode()||!e.canExtendAcross()),be.attr("disabled",!r.isEditMode()||!e.canExtendAlong()),ve.attr("disabled",!r.isEditMode()||!e.canShrinkAcross()),fe.attr("disabled",!r.isEditMode()||!e.canShrinkAlong()),pe.style.visibility="visible"},X.doResizeContainer=function(e){var t=X.getFlowManager().getSelectionManager().getSelections();t[0].getFlowType()===d.flowType().CONTAINER&&t[0].resizeOutline(e),pe.style.visibility="hidden",ge=!1},X.isBlockResizeBarVisible=function(){return ge},X.hideContainerBar=function(){pe.style.visibility="hidden"};var Ie,he=document.getElementById("switchResizeId"),we=e("#extendSwitchAcrossId"),Te=e("#shrinkSwitchAcrossId");X.showSwitchResizeBar=function(e){var t=e.getMenuBarPosition(),n=r.getScale();he.style.left=G.getBoundingClientRect().left+t.x*n+"px",he.style.top=G.getBoundingClientRect().top+t.y*n-24+"px",we.attr("disabled",!r.isEditMode()||!e.canExtendAcross()),Te.attr("disabled",!r.isEditMode()||!e.canShrinkAcross()),he.style.visibility="visible"},X.doResizeSwitch=function(e){var t=X.getFlowManager().getSelectionManager().getSelections();t[0].getFlowType()===d.flowType().SWITCH&&t[0].resizeOutline(e),he.style.visibility="hidden",Ie=!1},X.isSwitchResizeBarVisible=function(){return Ie},X.hideSwitchBar=function(){he.style.visibility="hidden"},X.showSearchList=i.observable(!1),X.showFindOptions=i.observable(!0),X.searchContentList=i.observableArray(),X.foundMatches=i.observable(),X.onFindTableClick=function(e){var t=e.target.innerText;y.selectedNewDisk(t)},X.onFindTableDblClick=function(e){X.onFindTableClick(e)},X.onPasteSearchText=function(e){y.selectedNewDisk(label)},X.currentPath=i.observable(),X.fsContentList=i.observableArray(),X.selectedPath=i.observable(),X.isOpenMode=i.observable(),X.isSaveMode=i.observable(),X.showPartitions=i.observable(!1),X.partitionsList=i.observableArray([""]),X.selectedPartition=i.observable(),X.filesTypes=i.observableArray([d.fileTypes().JSON,d.fileTypes().ALL]),X.selectedFileType=i.observable(d.fileTypes().JSON);X.callOpenFlowDialog=function(){setTimeout(function(){X.isConnectionOK()?ee.dialog({height:440}):ee.dialog({height:180}),X.manager.getRootDir(),ee.dialog("open")},200)},X.onDiskTableClick=function(e){var t=e.target.innerText;T.selectedNewDisk(t)},X.setFSDialogMode=function(e){de.setFSDialogMode(e)},X.getFSDialogMode=function(){return de.getFSDialogMode()},X.restoreWorkDir=function(){de.restoreWorkDir()},X.setWorkDir=function(e){de.setWorkDir(e)},X.getWorkDir=function(){return de.getWorkDir()},X.getSelectedFSDir=function(){return de.getSelectedFSDir()},X.getSelectedFSFile=function(){return de.getSelectedFSFile()},X.onDirTableClick=function(e){de.onDirTableClick(e)},X.deleteFSItem=function(){de.deleteFSItem()},X.onDirTableDblClick=function(e){de.onDirTableDblClick(e)},X.updateMainFSLocation=function(){de.updateMainFSLocation()},X.goOneDirBack=function(){de.goOneDirBack()},X.setDirsList=function(e,t){de.setDirsList(e,t)},X.setFolderContent=function(e,t){de.setFolderContent(e,t)},X.onFileTypeChange=function(e){de.onFileTypeChange(e)},X.showForegroundSelection=i.observable(!0),X.showBackgroundSelection=i.observable(!0),X.settingsSchemes=i.pureComputed(function(){return X.manager.getSettingsManager().getColorsSchemesList()});var De;X.setNewAction=function(e){De=e},X.isNewAction=function(){return De},X.filesList=i.observableArray();var Ne=[];X.setFilesList=function(t){if(Ne=t,X.filesList(t),X.filesList(_(t)),De)e("#newFlowDialogId").dialog("open");else;},X.selectedFile=i.observable(),X.getSelectedFile=function(){return X.isConnectionOK()?_selectedFile:X.selectedFile()},X.isInputInvalid=i.observable(!1),X.validateMessage=i.observable(""),X.newFSNameValue=i.observable(""),X.nameValueEmpty=i.observable(""),X.validateFSName=function(t,n){var i=R.trimMultipleSpaces(X.newFSNameValue()),o=n?a.getDirectoriesLabels():X.filesList();X.nameValueEmpty(0===i.length);var s=X.isInputInvalid(),r=R.containsFSName(o,i),l=R.isFSNameValid(X.newFSNameValue()),d=i.length>0&&(!l||r);X.isInputInvalid(d),s&&!d&&(e("#newFileNameId").blur(),e("#newFileNameId").focus()),e("#newFlowButtonOK").button("option","disabled",X.isInputInvalid()||X.nameValueEmpty()),e("#newFolderButtonOK").button("option","disabled",X.isInputInvalid()||X.nameValueEmpty()),l?r?X.validateMessage("Duplicate name"):X.validateMessage(""):X.validateMessage("Only alphanumericals, dots, dashes, underscores and single spaces"),t&&i.length>0&&l&&"Enter"===t.code&&(De?(h.createNewDiagram(X.manager),e("#newFlowDialogId").dialog("close")):(w.createNewFolder(X.manager),e("#newFolderDialogId").dialog("close")))},e("#newFlowDialogId").on("dialogopen",function(e,t){X.validateFSName()}),e("#newFlowDialogId").on("dialogclose",function(e,t){X.newFSNameValue("")}),X.saveAsInputInvalid=i.observable(!1),X.saveAsMessage=i.observable(""),X.saveAsFileNameValue=i.observable(""),X.saveAsNameEmpty=i.observable(""),X.validateSaveAsFileName=function(t){var n=R.trimMultipleSpaces(X.saveAsFileNameValue()),i=X.getCurrentShortFileName();X.saveAsNameEmpty(0===n.length);var o=X.saveAsInputInvalid(),a=n!==i&&R.containsFSName(X.filesList(),n),s=R.isFSNameValid(n),r=n.length>0&&(!s||a);X.saveAsInputInvalid(r),o&&!r&&(e("#saveAsFileNameId").blur(),e("#saveAsFileNameId").focus()),K(),s?a?X.saveAsMessage("Duplicate name"):X.saveAsMessage(""):X.saveAsMessage("Only alphanumericals, dots, dashes, underscores and single spaces"),n.length>0&&s&&t.code},X.saveAsNewVersion=i.observable(1),X.versionInputInvalid=i.observable(!1),X.validateAsVersion=function(e){var t=(X.saveAsNewVersion(),R.isVersionNumber(X.saveAsNewVersion()));X.versionInputInvalid(!t),K()},X.isFlowSaveBlocked=function(){return X.saveAsInputInvalid()||X.saveAsNameEmpty()||X.saveAsNewVersion()&&X.versionInputInvalid()};var ye=i.observable();X.propsLinkSourceName=i.observable(),X.propsLinkSourceLabel=i.observable(),X.propsLinkTargetName=i.observable(),X.propsLinkTargetLabel=i.observable(),X.propsLinkLabel=i.observable(),X.getPropsLink=function(){return ye()},X.getPropsLinkLabelValue=function(){return X.propsLinkLabel()},X.showLinkProps=function(t){ye(t),X.propsLinkSourceName(ye().getLinkSourcePortName()),X.propsLinkSourceLabel(ye().getLinkSourcePortLabel()),X.propsLinkTargetName(ye().getLinkTargetPortName()),X.propsLinkTargetLabel(ye().getLinkTargetPortLabel()),X.propsLinkLabel(ye().getLinkLabel()),e("#linkPropsDialogId").dialog("open")},X.editPropsLinkLabel=function(e){X.propsLinkLabel(document.getElementById("propsLinkLabelId").value)},X.propsFgndVisible=i.observable(!0),X.setPropsFgndVisible=function(e){X.propsFgndVisible(e)},X.propsNodeInputs=i.observableArray();var Ce,Le;X.getPropsNodeInputsIdx=function(){return Ce},X.getPropsNodeInputsValue=function(){return Le},X.propsNodeOutputs=i.observableArray();var Ee,ke;X.getPropsNodeOutputsIdx=function(){return Ee},X.getPropsNodeOutputsValue=function(){return ke},X.propsNodeRefInputs=i.observableArray();var Me,Fe;X.getPropsNodeRefInputsIdx=function(){return Me},X.getPropsNodeRefInputsValue=function(){return Fe},X.propsNodeRefOutputs=i.observableArray();var xe,Se;X.getPropsNodeRefOutputsIdx=function(){return xe},X.getPropsNodeRefOutputsValue=function(){return Se},X.isCardinalitySelected=i.observable(!0);var Pe=i.observable();X.getPropsNode=function(){return Pe()},X.showNodeProps=function(t){Pe(t),c.setNodeCategory(t.getNodeCategory()),X.propsNodeInputs(Pe().getInputPortsProperties()),X.propsNodeOutputs(Pe().getOutputPortsProperties()),X.propsNodeRefInputs(Pe().getRefInPortsProperties()),X.propsNodeRefOutputs(Pe().getRefOutPortsProperties()),X.dbNodeRecords(Pe().getDBRecords()),e("#nodePropsDialogId").dialog("open")},X.editPropsNodeInputLabel=function(e){Ce=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeInputsTableId"),n=t.getElementsByTagName("tr");Le=n[Ce].cells[2].getElementsByTagName("input")[0].value},X.checkPortInputCardinality=function(e){N.editPortInputCardinality(e)},X.editPropsNodeOutputLabel=function(e){Ee=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeOutputsTableId"),n=t.getElementsByTagName("tr");ke=n[Ee].cells[2].getElementsByTagName("input")[0].value},X.checkPortOutputCardinality=function(e){N.editPortOutputCardinality(e)},X.editPropsNodeRefInputLabel=function(e){Me=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeRefInputsTableId"),n=t.getElementsByTagName("tr");Fe=n[Me].cells[2].getElementsByTagName("input")[0].value},X.checkPortRefInputCardinality=function(e){N.editPortRefInputCardinality(e)},X.editPropsNodeRefOutputLabel=function(e){xe=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeRefOutputsTableId"),n=t.getElementsByTagName("tr");Se=n[xe].cells[2].getElementsByTagName("input")[0].value},X.checkPortRefOutputCardinality=function(e){N.editPortRefOutputCardinality(e)},X.dbNodeRecords=i.observableArray();X.dbTableErrorMsg=i.observable(!1),X.editNodeTableKey=function(e){N.processTableClickKey(e)},X.editNodeTableField=function(e){N.processTableClickField(e)},X.editNodeTableType=function(e){N.processTableClickType(e)},X.editNodeTableLength=function(e){N.processTableClickLength(e)},X.isEditNameInvalid=i.observable(!1),X.editNameValue=i.observable(""),X.validateNameMessage=i.observable("");var Re;X.setOldName=function(e){Re=e},X.validateInlineNodeName=function(){var e=X.manager.getInlineInputEditor().getCurrentValue(),t=R.trimMultipleSpaces(e);X.validateEditName(t)},X.validateDialogNodeName=function(){var e=R.trimMultipleSpaces(X.editNameValue());X.validateEditName(e)},X.validateEditName=function(e){if(e.length>0){var t=R.getAllNames(X.manager.getNodeNamesMap()),n=R.isDuplicateName(Re,e,t),i=R.isNewNodeNameValid(e),o=!n&&i;X.isEditNameInvalid(!o)}else X.isEditNameInvalid(!0);n?X.validateNameMessage("Duplicate name"):i?X.validateNameMessage(""):X.validateNameMessage("Only alphanumericals, dots, dashes, underscores and single spaces")},X.isLinkLabelInvalid=i.observable(!1),X.validateLinkMessage=i.observable("");var Ae;X.setOldLinkLabel=function(e){Ae=e},X.validateLinkLabel=function(e){var t=R.trimMultipleSpaces(X.propsLinkLabel());if(t.length>0){var n=R.getAllLinkLabels(X.manager.getLinkLabelsMap()),i=R.isDuplicateLabel(Ae,t,n),o=t===Ae||R.isNewLinkLabelValid(t),a=!i&&o;X.isLinkLabelInvalid(!a)}else X.isLinkLabelInvalid(!1);i?X.validateLinkMessage("Duplicate label"):o?X.validateLinkMessage(""):X.validateLinkMessage("Only alphanumericals, dots, dashes, underscores and single spaces")},X.pictureURLValue=i.observable(""),X.isPictureURLInvalid=i.observable(!1),X.validatePictureURL=function(e){X.isPictureURLInvalid(!1)};var Oe=d.decisionRun().NONE,Be=void 0;X.showNewFileName=i.observable(),X.showEditedInfo=i.observable(),X.showDecisionInfo=i.observable(),X.decisionInputPicture=i.observable(),X.decisionEndsPicture=i.observable(),X.isNodeNameInvalid=i.observable(!1),X.newNodeNameValue=i.observable(""),X.invalidNameMessage=i.observable(""),X.newDecisionInput=i.observable(m.getCurrentDecisionInput()),X.newDecisionEnds=i.observable(m.getCurrentDecisionEnds()),X.editedDecisionNodeName=i.observable("???"),X.setDecisionRun=function(e,t){if(Oe=t,t===d.decisionRun().CREATE){var n=O.getSelectedFlowType();X.showNewFileName(!0),X.showEditedInfo(!1),X.showDecisionInfo(n===d.flowType().DECISION)}else t===d.decisionRun().EDIT&&(Be=e,m.setCurrentInput(e.getInput()),m.setCurrentEnds(e.getEnds()),X.editedDecisionNodeName(e.getName()),X.newDecisionInput(m.getCurrentDecisionInput()),X.newDecisionEnds(m.getCurrentDecisionEnds()),X.decisionInputPicture(m.getCurrentInputPicture()),X.decisionEndsPicture(m.getCurrentEndsPicture()),X.showNewFileName(!1),X.showEditedInfo(!0),X.showDecisionInfo(!0))},X.getEditedDecisionNode=function(){return Be},X.getDecisionRun=function(){return Oe},X.validateNodeName=function(t){var n=R.trimMultipleSpaces(X.newNodeNameValue());O.getSelectedFlowType();if(n.length>0){var i=R.isNodeNameValid(n),o=R.getAllNames(X.manager.getNodeNamesMap()),a=R.isNodeNameDuplicate(n,o);if(X.isNodeNameInvalid(!i||a),i&&!a&&"Enter"===t.code)return D.proceed(X.manager),void e("#newNodeDialogId").dialog("close")}e("#newNodeButtonOK").button("option","disabled",X.isNodeNameInvalid()||0==n.length),i?a?X.invalidNameMessage("Duplicate name"):X.invalidNameMessage(""):X.invalidNameMessage("Only alphanumericals, dots, dashes, underscores and single spaces")},X.getDecisionIcon=function(){return X.updateTrigger(!X.updateTrigger()),m.getDecisionIcon()},X.resetDecisionIndices=function(){X.updateTrigger(!X.updateTrigger()),m.resetCurrentInputIndex(),m.resetCurrentEndsIndex(),X.decisionInputPicture(m.getCurrentInputPicture()),X.decisionEndsPicture(m.getCurrentEndsPicture()),X.newDecisionInput(m.getCurrentDecisionInput()),X.newDecisionEnds(m.getCurrentDecisionEnds())},X.moveDecisionInputNext=function(){X.updateTrigger(!X.updateTrigger()),m.moveInputNext(),X.newDecisionInput(m.getCurrentDecisionInput()),X.decisionInputPicture(m.getCurrentInputPicture()),X.decisionEndsPicture(m.getCurrentEndsPicture());var t=R.trimMultipleSpaces(X.newNodeNameValue());X.editedDecisionNodeName(z()),e("#newNodeButtonOK").button("option","disabled",X.getDecisionRun()!==d.decisionRun().EDIT&&(X.isNodeNameInvalid()||0==t.length))},X.moveDecisionInputPrev=function(){X.updateTrigger(!X.updateTrigger()),m.moveInputPrevious(),X.newDecisionInput(m.getCurrentDecisionInput()),X.decisionInputPicture(m.getCurrentInputPicture()),X.decisionEndsPicture(m.getCurrentEndsPicture());var t=R.trimMultipleSpaces(X.newNodeNameValue());X.editedDecisionNodeName(z()),e("#newNodeButtonOK").button("option","disabled",X.getDecisionRun()!==d.decisionRun().EDIT&&(X.isNodeNameInvalid()||0==t.length))},X.moveDecisionEndsNext=function(){X.updateTrigger(!X.updateTrigger()),m.moveEndsNext(),X.newDecisionEnds(m.getCurrentDecisionEnds()),X.decisionEndsPicture(m.getCurrentEndsPicture());var t=R.trimMultipleSpaces(X.newNodeNameValue());X.editedDecisionNodeName(z()),e("#newNodeButtonOK").button("option","disabled",X.getDecisionRun()!==d.decisionRun().EDIT&&(X.isNodeNameInvalid()||0==t.length))},X.moveDecisionEndsPrev=function(){X.updateTrigger(!X.updateTrigger()),m.moveEndsPrevious(),X.newDecisionEnds(m.getCurrentDecisionEnds()),X.decisionEndsPicture(m.getCurrentEndsPicture());var t=R.trimMultipleSpaces(X.newNodeNameValue());X.editedDecisionNodeName(z()),e("#newNodeButtonOK").button("option","disabled",X.getDecisionRun()!==d.decisionRun().EDIT&&(X.isNodeNameInvalid()||0==t.length))},X.btnFlowH2click=function(){X.changeFlowDirection(d.flow().VERTICAL)},X.btnFlowV2click=function(){X.changeFlowDirection(d.flow().HORIZONTAL)},X.changeFlowDirection=function(e){U(e)};var Ve=!1;X.hasFlowDirectionChange=function(){return Ve},X.setFlowDirectionChange=function(){Ve=!0},X.resetFlowDirectionChange=function(){Ve=!1},X.isHorizontal=i.observable(!1),X.layoutModeText=i.observable(r.getLayoutModeText()),X.diagramModeText=i.observable(r.getDiagramModeText());var He=(e("#newId"),e("#openId"),e("#importId")),We=e("#undoId"),_e=e("#redoId"),Ke=e("#findId"),ze=e("#refreshId"),Ue=e("#clearId"),Ze=e("#leftId"),je=e("#rightId"),qe=e("#deleteId"),Xe=e("#copyId"),Ge=e("#pasteId"),Je=e("#saveId"),$e=e("#saveAsId"),Ye=e("#btnFlowVId");e("#btnThumbnailId");X.updateWindow=function(t){X.updateTrigger(!X.updateTrigger()),X.isHorizontal(r.getFlowDirection()===d.flow().HORIZONTAL),X.layoutModeText(r.getLayoutModeText()),X.diagramModeText(r.getDiagramModeText());var n=!r.isEditMode();s.updateMenus(X),He.attr("disabled",!X.isConnectionOK()),We.attr("disabled",n||!X.manager.canUndo()).attr("title",X.manager.getUndoName()),_e.attr("disabled",n||!X.manager.canRedo()).attr("title",X.manager.getRedoName()),qe.attr("disabled",n||!X.manager.getSelectionManager().hasSelections()),Xe.attr("disabled",n||!X.manager.canCopy()),Ge.attr("disabled",n||!X.manager.readyToPaste()),Je.attr("disabled",n||!X.isConnectionOK()||!X.manager.isDirty()),$e.attr("disabled",n||!X.isConnectionOK()||X.manager.getModelHandler().isDiagramEmpty()),ze.attr("disabled",!X.isCanvasVisible()),Ke.attr("disabled",!X.isCanvasVisible()),Ue.attr("disabled",n||!X.isCanvasVisible()),Ze.attr("disabled",!X.manager.hasPreviousDiagram()),je.attr("disabled",!X.manager.hasNextDiagram()),Ye.attr("disabled",r.getAppMode()!==d.appMode().FLOW_MODE),e("#btnFlowHId").attr("disabled",n),e("#btnFlowVId").attr("disabled",n),"visible"!==document.getElementById("blockResizeId").style.visibility||ge?ge&&(document.getElementById("blockResizeId").style.visibility="hidden",ge=!1):ge=!0,"visible"!==document.getElementById("switchResizeId").style.visibility||Ie?Ie&&(document.getElementById("switchResizeId").style.visibility="hidden",Ie=!1):Ie=!0,X.manager.isInitialResizeMode()&&X.manager.getModelHandler().isDiagramEmpty()?(te.spinner("enable"),ne.spinner("enable")):(te.spinner("disable"),ne.spinner("disable"))},X.initData=function(){X.updateWindow()},X.galleryFlowNodes=i.pureComputed(function(){return X.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getFlowNodesH():u.getFlowNodesV()}),X.galleryMiscNodes=i.pureComputed(function(){return X.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getMiscNodesH():u.getMiscNodesV()}),X.galleryERDNodes=i.pureComputed(function(){return X.updateTrigger(),u.getERDNodes()}),X.pageNodes=i.pureComputed(function(){X.updateTrigger();for(var e=[],t=r.getFlowDirection()===d.flow().HORIZONTAL?u.getHPageItems():u.getVPageItems(),n=0;n<t.length;n++)e.push(t[n]);return e}),X.diagramDisplayName=i.observable(ae),X.setDiagramDisplayName=function(e){e&&e.length>0?X.diagramDisplayName(e):X.diagramDisplayName(ae)},X.aboutTitle=i.observable(""),X.aboutVersion=i.observable(""),X.aboutText=i.observable(""),X.aboutSources=i.observable(""),X.aboutCopyright=i.observable(""),X.showAboutBox=function(t,n,i,o,a){X.aboutTitle(t),X.aboutVersion(n),X.aboutText(i),X.aboutSources(o),X.aboutCopyright(a),e("#aboutDialogId").dialog("open")},X.welcomeTitle=i.observable(""),X.welcomeGreeting=i.observable(""),X.welcomeTo=i.observable(""),X.welcomeTip=i.observable(""),X.showWelcomeBox=function(t,n,i,o){X.welcomeTitle(t),X.welcomeGreeting(n),X.welcomeTo(i),X.welcomeTip(o),e("#welcomeDialogId").dialog("open")},X.integrationTitle=i.observable(V.getTopTitle()),X.integrationTopNotes=i.observable(V.getTopNotes()),X.integrationReactTitle=i.observable(V.getReactTitle()),X.integrationReactNotesTop=i.observable(V.getReactNotesTop()),
X.integrationReactNotesBottom=i.observable(V.getReactNotesBottom()),X.integrationAngularTitle=i.observable(V.getAngularTitle()),X.integrationAngularNotesTop=i.observable(V.getAngularNotesTop()),X.infoMessage=i.observable(""),X.infoMessageVisible=i.observable(),X.showInfoMessage=function(t,n){X.infoMessage(t),X.infoMessageVisible(!1),e("#infoDialogId").dialog("open"),n&&e("#infoDialogId").dialog("option","title",n)},e("#infoDialogId").on("dialogopen",function(t,n){setTimeout(function(){X.infoMessageVisible(!0),e("#infoTextId").scrollTop(0)},200)});var Qe;X.getConfirmFlag=function(){return Qe},X.setConfirmFlag=function(e){Qe=e},X.confirmMessage=i.observable(""),X.showConfirmMessage=function(t,n,i){F.initDialog(X.manager),X.confirmMessage(t),n&&ie.dialog("option","title",n),i&&(e(e("button",ie.parent())[1]).text(i.first),e(e("button",ie.parent())[2]).text(i.second)),ie.dialog("open")},X.isShowThumbnail=i.observable(),X.btnThumbnailShow=function(){X.isShowThumbnail(!0),e("#thumbnailDialogId").dialog("open"),X.repaintDiagram()},X.btnThumbnailHide=function(){X.isShowThumbnail(!1),X.repaintDiagram()},X.overlayText=i.observable("");var et=e("#saveOverlayId");X.showOverlayMessage=function(e,t){var n=t||400;X.overlayText(e),et.show(),setTimeout(function(){et.fadeOut(n)},n+200)},X.bottomMessageText=i.observable("");var tt=e("#bottomOverlayId");X.showBottomMessage=function(e,t){var n=t||1e3;X.bottomMessageText(e),tt.show(),setTimeout(function(){tt.fadeOut(n)},n+200)},Y.addEventListener("scroll",function(e){e.currentTarget.scrollLeft||e.currentTarget.scrollRight}),oe.addEventListener("mousemove",function(e){j()},!1),oe.onchange=function(){j()};var nt;X.getDraggedPaletteId=function(){return nt},X.setDraggedPaletteId=function(e){nt=e},X.onPaletteDragStart=function(e){nt=e.target.id,e.dataTransfer.setData("text",e.target.id)},X.onPaletteDragEnd=function(e){var t=G.getBoundingClientRect();e.clientX>t.left&&e.clientX<t.right&&e.clientY>t.top&&e.clientY<t.bottom||X.manager.getDnDHandler().resetDrag()},X.requestFocus=function(){},X.isControlPressed=function(){return se},X.setControlPressed=function(e){se=e},X.isEditControlPressed=function(){return le},X.setEditControlPressed=function(e){le=e},X.isShiftPressed=function(){return re},X.setShiftPressed=function(e){re=e},window.onresize=function(){e("#settingsDialogId").dialog({position:{my:"right top",at:"right-4 top+4",of:window}}),e("#nodePropsDialogId").dialog({position:{my:"right top",at:"right-4 top+4",of:window}}),e("#linkPropsDialogId").dialog({position:{my:"right top",at:"right-4 top+4",of:window}}),e("#thumbnailDialogId").dialog({position:{my:"right bottom",at:"right-8 bottom-6",of:window}}),e("#findDialogId").dialog({position:{my:"right top",at:"right-4 top-4",of:window}}),q(),X.manager.getInlineInputEditor().relocateInlineFieldEditor(),X.manager.getInlineAreaEditor().relocateInlineAreaEditor(),j(),X.repaintDiagram()},window.onscroll=function(){e("#settingsDialogId").dialog({position:{my:"right top",at:"right-4 top+4",of:window}}),e("#nodePropsDialogId").dialog({position:{my:"right top",at:"right-4 top+4",of:window}}),e("#linkPropsDialogId").dialog({position:{my:"right top",at:"right-4 top+4",of:window}}),e("#thumbnailDialogId").dialog({position:{my:"right bottom",at:"right-8 bottom-6",of:window}}),e("#findDialogId").dialog({position:{my:"right top",at:"right-4 top+4",of:window}}),X.repaintDiagram()};var it=0,ot=e("#containerId");return X.repaintDiagram=function(){X.hideContainerBar(),X.hideSwitchBar(),X.manager.paintDiagram()},i.applyBindings(X),X.initData(),{initFlowDemo:function(){window.scrollTo(0,0),e(window).trigger("resize"),X.setProgressBarVisible(!1),X.showOverlayMessage("Connecting to server...",1e3),o.checkServerConnection(X.manager)}}});