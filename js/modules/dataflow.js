define(["jquery","jqueryui","jqueryuictxm","knockout","modules/server/ioHandler","modules/fs/directories","modules/html/toolbar","modules/settings/config","modules/actions/frameActions","modules/graph/graphConstants","modules/gallery/components","modules/gallery/iconOptionsPicker","modules/gallery/decisionEnds","modules/flow/flowManager","modules/fs/fsBrowser","modules/diagram/mouseInteractor","modules/dialogs/newFlowDialog","modules/dialogs/newFolderDialog","modules/dialogs/openFlowDialog","modules/dialogs/createNodeDialog","modules/dialogs/nodePropsDialog","modules/dialogs/findDialog","modules/dialogs/linkPropsDialog","modules/dialogs/aboutDialog","modules/dialogs/infoDialog","modules/dialogs/confirmDialog","modules/dialogs/thumbnailDialog","modules/settings/settingsDialog","modules/dialogs/text1ViewDialog","modules/dialogs/text2ViewDialog","modules/settings/settingsActions","modules/geometry/point","modules/util/utils","modules/draw/draw","modules/controller/flowCache","modules/exportLayout/exportManager","modules/exportLayout/demoFlow","modules/util/integrationText"],function(e,t,n,o,i,a,s,r,l,d,u,c,g,p,m,b,f,v,w,I,N,D,h,T,M,C,y,L,E,F,k,x,O,S,P,A,V,R){function B(e){e===d.flow().VERTICAL?(ge.removeClass("block-extendV"),ge.addClass("block-extendH"),pe.removeClass("block-extendH"),pe.addClass("block-extendV"),me.removeClass("block-shrinkV"),me.addClass("block-shrinkH"),be.removeClass("block-shrinkH"),be.addClass("block-shrinkV")):e===d.flow().HORIZONTAL&&(ge.removeClass("block-extendH"),ge.addClass("block-extendV"),pe.removeClass("block-extendV"),pe.addClass("block-extendH"),me.removeClass("block-shrinkH"),me.addClass("block-shrinkV"),be.removeClass("block-shrinkV"),be.addClass("block-shrinkH"))}function H(e){e===d.flow().VERTICAL?(we.removeClass("block-extendV"),we.addClass("block-extendH"),Ie.removeClass("block-shrinkV"),Ie.addClass("block-shrinkH")):e===d.flow().HORIZONTAL&&(we.removeClass("block-extendH"),we.addClass("block-extendV"),Ie.removeClass("block-shrinkH"),Ie.addClass("block-shrinkV"))}function K(){return Ae?Ae.getName():"[none]"}function z(e){r.setFlowDirection(e),U.setFlowDirectionChange(),B(e),H(e),U.getFlowManager().hasDiagramOpen()&&U.flowManager.setDirty(!0),U.getFlowManager().refreshDiagramOnEdit(),U.setConfirmFlag(d.bValue().FALSE)}function W(){e("#settingsDialogId").dialog({position:{my:"right top+10",at:"right top",of:"#topContainerId"}}),e("#nodePropsDialogId").dialog({position:{my:"right top+10",at:"right top",of:"#topContainerId"}}),e("#linkPropsDialogId").dialog({position:{my:"right top+10",at:"right top",of:"#topContainerId"}}),e("#thumbnailDialogId").dialog({position:{my:"right bottom",at:"right-17 bottom-4",of:window}}),e("#findDialogId").dialog({position:{my:"right top",at:"right-4 top-4",of:window}}),_(),U.repaintDiagram()}function _(){var t=e(window).height();e(window).scrollTop();it.height(t-ot)}var U=this,Z=document.getElementById("canvasId"),j=document.getElementById("canvasThId"),J=Z.getContext("2d"),q=document.getElementById("containerId"),X=document.getElementById("topContainerId"),Q=(document.getElementById("containerId"),e("#topContainerId"),e("#openFlowDialogId")),$=e("#spinnerLevelsId"),Y=e("#spinnerLanesId"),G=e("#confirmDialogId"),ee=(e("#thumbnailDialogId"),"[select 'New' or 'Open' from menus]"),te=!1,ne=!1,oe=!1;U.accHdrDemoTitle=o.observable(d.appTitles().FLOW_TITLE),U.accHdrPagesTitle=o.observable(d.appTitles().PAGES_TITLE),U.accHdrBpelTitle=o.observable(d.appTitles().BPEL_TITLE),U.accHdrK8sTitle=o.observable(d.appTitles().K8S_TITLE),U.getCanvas=function(){return Z},U.getCanvasTh=function(){return j},U.getCanvasContext=function(){return J},U.getCanvasContainer=function(){return q},U.getTopContainer=function(){return X},U.flowManager=new p(U),U.interactor=U.flowManager.getMouseInteractor(),U.dndHandler=U.flowManager.getDnDHandler(),U.updateTrigger=o.observable(!1);var ie=new m(U);U.getFlowManager=function(){return U.flowManager};var ae=new A(U),se=Date.now(),re=!1,le=!!r.isDemoOnly();U.isConnectionOK=o.observable(re),U.cnxResultOK=function(){console.log("*** connection OK!!!")},U.cnxResultFAIL=function(e){console.log("*** connection FAIL: "+e.readyState+", __cnxOK="+re),Date.now()-se<3e3?(re=!1,U.showOverlayMessage("No server connection",500)):(re=!0,U.showOverlayMessage("Connected",500)),U.isConnectionOK(re),le=!0,setTimeout(function(){console.log("*** connection: "+re),U.updateWindow()},200)},U.initOK=function(){return le},e(document).ready(function(){function t(t){return e("<img>",{style:"margin: 0 6px -2px -22px;",src:c.getIconURL(t.value)})}function n(t){return e("<img>",{style:"margin: 0 6px -2px 0;",src:c.getIconURL(t.value)})}J.canvas.width=0,J.canvas.height=0,f.initDialog(U.flowManager),v.initDialog(U.flowManager),w.initDialog(U.flowManager),L.initDialog(U.flowManager),E.initDialog(U.flowManager),F.initDialog(U.flowManager),I.initDialog(U.flowManager),N.initDialog(U.flowManager),D.initDialog(U.flowManager),h.initDialog(U.flowManager),T.initDialog(U.flowManager),M.initDialog(U.flowManager),C.initDialog(U.flowManager),y.initDialog(U.flowManager),s.initButtons(U),l.initActions(U),k.initButtons(U),e("#canvasId").contextmenu(U.interactor.getContextMenu()),X.addEventListener("mousemove",function(t){U.interactor.isOverCanvas(t)||(e("#canvasId").contextmenu("close"),U.flowManager.getFlowDiagram().setMousePoint(void 0))}),X.addEventListener("mousedown",function(e){}),e("#paletteCtrId").show(),e("#paletteAccordionId").accordion({heightStyle:"fill",collapsible:!0,activate:function(e,t){U.updateWindow()}}),e("#paletteAccordionId").accordion("option","icons",{header:null,headerSelected:null}),e("#settingsTabId").tabs({}),e("#integrationTabId").tabs({}),e("#nodePropsTabId").tabs({activate:function(t,n){1===n.newTab.index()?e("#nodePropsTabId").css({overflow:"auto"}):e("#nodePropsTabId").css({overflow:"hidden"})}}),e("#infoTextId").attr("visibility","hidden"),$.spinner({step:1,min:d.canvasRange().MIN,max:d.canvasRange().MAX,numberFormat:"n"}),$.spinner("value",d.initial().LEVELS),$.spinner("enable"),Y.spinner({step:1,min:d.canvasRange().MIN,max:d.canvasRange().MAX,numberFormat:"n"}),Y.spinner("value",d.initial().LANES),Y.spinner("enable");var o=e("#progressBarId");o.progressbar({value:!1}),o.height(14),e.widget("nodeIcons.iconselectmenu",e.ui.selectmenu,{_renderButtonItem:function(t){var o=e("<div>",{text:c.getIconLabel(t.value)});return n(t).prependTo(o),o},_renderItem:function(n,o){var i=e("<li>"),a=e("<div>",{text:c.getIconLabel(o.value)});return t(o).prependTo(a),i.append(a).appendTo(n)},_renderMenu:function(t,n){var o=this,i=c.getOptionItems(n);e.each(i,function(e,n){o._renderItemData(t,n)})},refreshButtonItem:function(e,t){var n=c.getIndexValue(e,t);this.element[0].selectedIndex=n,this.refresh()}}),e("#nodeIconItemsId").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons customicons"),e("#settingIconItemsId").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons customicons"),e.widget("settings.schememenu",e.ui.selectmenu,{_renderButtonItem:function(t){return e("<div>",{text:"Default"})}}),e("#settingSchemesId").schememenu({width:240}).schememenu("menuWidget").addClass("ui-menu-icons schememenu"),e("#selectPartitionId").selectmenu({select:function(e,t){if(e.currentTarget){var n=e.currentTarget.textContent;console.log("$$$ disk select: "+n),U.selectedPartition(n)}},change:function(e,t){var n=e.currentTarget.textContent;console.log("### disk change: "+n)},create:function(e,t){setTimeout(function(){U.flowManager.getDiskNames()},1e3)}}).addClass("settingsDiskMenu").css("fontSize","16px"),e("#selectFileTypeId").selectmenu({create:function(t,n){setTimeout(function(){U.selectedFileType(d.fileTypes().JSON),e("#selectFileTypeId").selectmenu("refresh")},1e3)},select:function(e,t){if(e.currentTarget){var n=e.currentTarget.textContent;U.selectedFileType(n),U.flowManager.getDirContent()}}}).addClass("settingsDiskMenu"),e.widget("demomenu.demofilesmenu",e.ui.selectmenu,{_renderButtonItem:function(t){return e("<div>",{text:t.label?t.label:U.flowManager.getDemoList()[0].label})}}),e("#selectFileId").demofilesmenu().demofilesmenu("menuWidget").addClass("ui-menu-icons demofiles")}),U.isAutoLayoutAllowed=o.observable(r.isAllowAuto()),U.forceTestAutoMode=function(e){r.setLayoutMode(d.layoutMode().AUTO),U.flowManager.getSelectionManager().clearSelections(),U.flowManager.resetScale(),U.runTestAutoMode()},U.resetTestAutoMode=function(){U.flowManager.clearDiagram(),r.setLayoutMode(d.layoutMode().MANUAL)},U.runTestAutoMode=function(){U.flowManager.createDiagram("ReactDemo");var e=V.getJSONFile(),t={title:"React Demo",direction:2,startEnd:!0,swimLanes:!1},n=ae.createLayout(e,t);console.log("Demo Flow: "+JSON.stringify(n,null,2)),U.flowManager.adjustCanvas(),U.flowManager.paintDiagram()},U.nodeEmojiItems=o.pureComputed(function(){return c.getNodeIconOptions()}),U.demoFilesItems=o.pureComputed(function(){return U.flowManager.getDemoList()}),U.nodeActionsList=o.pureComputed(function(){return N.getActionsList()}),U.nodeOperationsList=o.pureComputed(function(){return N.getOperationsList()}),U.nodeServicesList=o.pureComputed(function(){return N.getServicesList()}),U.onOpsActionChange=function(e){},U.isProgressBarVisible=o.observable(!1),U.isProgressBarVisible.extend({notify:"always"}),U.setProgressBarVisible=function(e){U.isProgressBarVisible(e)},U.showPageMode=o.observable(r.hasPageMode()),U.isCanvasVisible=o.observable(!1),U.setCanvasVisible=function(e){U.isCanvasVisible(e)},U.scaleValue=o.observable(r.getScale());var de=document.getElementById("scaleId");de.oninput=function(){r.setScale(this.value/d.scale().FACTOR),U.scaleValue(r.getScale()),U.flowManager.clearClipboard(),U.flowManager.getFlowDiagram().clearCanvas(),U.flowManager.paintDiagram()},de.onchange=function(){U.flowManager.refreshDiagramOnEdit()},U.editModeText=o.observable(r.isEditMode()?d.editModeText().EDIT:d.editModeText().VIEW),U.setEditModeText=function(e){e===d.editMode().EDIT_ALL?U.editModeText(d.editModeText().EDIT):U.editModeText(d.editModeText().VIEW)},U.setTooltipBox=function(e,t){e.length>0&&r.isEditMode()&&S.drawTooltip(J,Z.getBoundingClientRect(),t,e)},U.showTooltipBox=function(e){},U.getCurrentFileName=function(){var e=U.flowManager.getFileName(),t=e.indexOf(".json");return e.substring(0,t)};var ue,ce=document.getElementById("blockResizeId"),ge=e("#extendBlockAcrossId"),pe=e("#extendBlockAlongId"),me=e("#shrinkBlockAcrossId"),be=e("#shrinkBlockAlongId");U.showBlockResizeBar=function(e){var t=e.getExpandedShape(),n=r.getScale();ce.style.left=Z.getBoundingClientRect().left+t.x*n+"px",ce.style.top=Z.getBoundingClientRect().top+t.y*n-24+"px",ge.attr("disabled",!r.isEditMode()||!e.canExtendAcross()),pe.attr("disabled",!r.isEditMode()||!e.canExtendAlong()),me.attr("disabled",!r.isEditMode()||!e.canShrinkAcross()),be.attr("disabled",!r.isEditMode()||!e.canShrinkAlong()),ce.style.visibility="visible"},U.doResizeContainer=function(e){var t=U.getFlowManager().getSelectionManager().getSelections();t[0].getFlowType()===d.flowType().CONTAINER&&t[0].resizeOutline(e),ce.style.visibility="hidden",ue=!1},U.isBlockResizeBarVisible=function(){return ue},U.hideContainerBar=function(){ce.style.visibility="hidden"};var fe,ve=document.getElementById("switchResizeId"),we=e("#extendSwitchAcrossId"),Ie=e("#shrinkSwitchAcrossId");U.showSwitchResizeBar=function(e){var t=e.getMenuBarPosition(),n=r.getScale();ve.style.left=Z.getBoundingClientRect().left+t.x*n+"px",ve.style.top=Z.getBoundingClientRect().top+t.y*n-24+"px",we.attr("disabled",!r.isEditMode()||!e.canExtendAcross()),Ie.attr("disabled",!r.isEditMode()||!e.canShrinkAcross()),ve.style.visibility="visible"},U.doResizeSwitch=function(e){var t=U.getFlowManager().getSelectionManager().getSelections();t[0].getFlowType()===d.flowType().SWITCH&&t[0].resizeOutline(e),ve.style.visibility="hidden",fe=!1},U.isSwitchResizeBarVisible=function(){return fe},U.hideSwitchBar=function(){ve.style.visibility="hidden"},U.showSearchList=o.observable(!1),U.showFindOptions=o.observable(!0),U.searchContentList=o.observableArray(),U.foundMatches=o.observable(),U.onFindTableClick=function(e){var t=e.target.innerText;D.selectedNewDisk(t)},U.onFindTableDblClick=function(e){U.onFindTableClick(e)},U.onPasteSearchText=function(e){D.selectedNewDisk(label)},U.currentPath=o.observable(),U.fsContentList=o.observableArray(),U.selectedPath=o.observable(),U.isOpenMode=o.observable(),U.isSaveMode=o.observable(),U.showPartitions=o.observable(!1),U.partitionsList=o.observableArray([""]),U.selectedPartition=o.observable("D:"),U.filesTypes=o.observableArray([d.fileTypes().JSON,d.fileTypes().ALL]),U.selectedFileType=o.observable(d.fileTypes().JSON);U.callOpenFlowDialog=function(){U.isConnectionOK()?Q.dialog({height:440}):Q.dialog({height:180}),Q.dialog("open")},U.onDiskTableClick=function(e){var t=e.target.innerText;w.selectedNewDisk(t)},U.setFSDialogMode=function(e){ie.setFSDialogMode(e)},U.getFSDialogMode=function(){return ie.getFSDialogMode()},U.restoreWorkDir=function(){ie.restoreWorkDir()},U.setWorkDir=function(e){ie.setWorkDir(e)},U.getWorkDir=function(){return ie.getWorkDir()},U.getSelectedFSDir=function(){return ie.getSelectedFSDir()},U.getSelectedFSFile=function(){return ie.getSelectedFSFile()},U.onDirTableClick=function(e){ie.onDirTableClick(e)},U.deleteFSItem=function(){ie.deleteFSItem()},U.onDirTableDblClick=function(e){ie.onDirTableDblClick(e)},U.updateMainFSLocation=function(){ie.updateMainFSLocation()},U.goOneDirBack=function(){ie.goOneDirBack()},U.setDirsList=function(e,t){ie.setDirsList(e,t)},U.setFolderContent=function(e,t){ie.setFolderContent(e,t)},U.onFileTypeChange=function(e){ie.onFileTypeChange(e)},U.showBackgroundSelection=o.observable(!0),U.settingsSchemes=o.observableArray(["Default"]),U.selectedScheme=o.observable("Default"),U.onSchemeChange=function(e){U.selectedScheme().split(".").pop()};var Ne;U.setNewAction=function(e){Ne=e},U.isNewAction=function(){return Ne},U.filesList=o.observableArray();var De=[];U.setFilesList=function(t){if(De=t,U.filesList(t),U.filesList(filterFilesList(t)),Ne)e("#newFlowDialogId").dialog("open");else;},U.selectedFile=o.observable(),U.getSelectedFile=function(){return U.isConnectionOK()?_selectedFile:U.selectedFile()},U.isInputInvalid=o.observable(!1),U.validateMessage=o.observable(""),U.newFSNameValue=o.observable(""),U.nameValueEmpty=o.observable(""),U.validateFSName=function(t,n){var o=U.newFSNameValue().trim(),i=n?a.getDirectoriesLabels():U.filesList();U.nameValueEmpty(0===o.length);var s=U.isInputInvalid(),r=O.containsFSName(i,o),l=O.isFSNameValid(U.newFSNameValue()),d=o.length>0&&(!l||r);U.isInputInvalid(d),s&&!d&&(e("#newFileNameId").blur(),e("#newFileNameId").focus()),e("#newFlowButtonOK").button("option","disabled",U.isInputInvalid()||U.nameValueEmpty()),e("#newFolderButtonOK").button("option","disabled",U.isInputInvalid()||U.nameValueEmpty()),l?r?U.validateMessage("Duplicate name"):U.validateMessage(""):U.validateMessage("Only alphanumeric characters, dots, dashes, and underscores"),t&&o.length>0&&l&&"Enter"===t.code&&(Ne?(f.createNewDiagram(U.flowManager),e("#newFlowDialogId").dialog("close")):(v.createNewFolder(U.flowManager),e("#newFolderDialogId").dialog("close")))},e("#newFlowDialogId").on("dialogopen",function(e,t){U.validateFSName()}),e("#newFlowDialogId").on("dialogclose",function(e,t){U.newFSNameValue("")}),U.saveAsInputInvalid=o.observable(!1),U.saveAsMessage=o.observable(""),U.saveAsFileNameValue=o.observable(""),U.saveAsNameEmpty=o.observable(""),U.validateSaveAsFileName=function(t){var n=U.saveAsFileNameValue().trim();U.saveAsNameEmpty(0===n.length);var o=U.saveAsInputInvalid(),i=n!==U.getCurrentFileName()&&O.containsFSName(U.filesList(),n),a=O.isFSNameValid(U.saveAsFileNameValue()),s=n.length>0&&(!a||i);U.saveAsInputInvalid(s),o&&!s&&(e("#saveAsFileNameId").blur(),e("#saveAsFileNameId").focus()),e("#saveAsButtonSave").button("option","disabled",U.saveAsInputInvalid()||U.saveAsNameEmpty()),a?i?U.saveAsMessage("Duplicate name"):U.saveAsMessage(""):U.saveAsMessage("Only alphanumeric characters, dots, dashes, and underscores"),n.length>0&&a&&t.code};var he=o.observable();U.propsLinkSourceName=o.observable(),U.propsLinkSourceLabel=o.observable(),U.propsLinkTargetName=o.observable(),U.propsLinkTargetLabel=o.observable(),U.propsLinkLabel=o.observable(),U.getPropsLink=function(){return he()},U.getPropsLinkLabelValue=function(){return U.propsLinkLabel()},U.showLinkProps=function(t){he(t),U.propsLinkSourceName(he().getLinkSourcePortName()),U.propsLinkSourceLabel(he().getLinkSourcePortLabel()),U.propsLinkTargetName(he().getLinkTargetPortName()),U.propsLinkTargetLabel(he().getLinkTargetPortLabel()),U.propsLinkLabel(he().getLinkLabel()),e("#linkPropsDialogId").dialog("open")},U.editPropsLinkLabel=function(e){U.propsLinkLabel(document.getElementById("propsLinkLabelId").value)},U.propsNodeInputs=o.observableArray();var Te,Me;U.getPropsNodeInputsIdx=function(){return Te},U.getPropsNodeInputsValue=function(){return Me},U.propsNodeOutputs=o.observableArray();var Ce,ye;U.getPropsNodeOutputsIdx=function(){return Ce},U.getPropsNodeOutputsValue=function(){return ye},U.propsNodeRefInputs=o.observableArray();var Le,Ee;U.getPropsNodeRefInputsIdx=function(){return Le},U.getPropsNodeRefInputsValue=function(){return Ee},U.propsNodeRefOutputs=o.observableArray();var Fe,ke;U.getPropsNodeRefOutputsIdx=function(){return Fe},U.getPropsNodeRefOutputsValue=function(){return ke};var xe=o.observable();U.getPropsNode=function(){return xe()},U.showNodeProps=function(t){xe(t),c.setNodeCategory(t.getNodeCategory()),U.propsNodeInputs(xe().getInputPortsFullNames()),U.propsNodeOutputs(xe().getOutputPortsFullNames()),U.propsNodeRefInputs(xe().getRefInPortsFullNames()),U.propsNodeRefOutputs(xe().getRefOutPortsFullNames()),e("#nodePropsDialogId").dialog("open")},U.editPropsNodeInputLabel=function(e){Te=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeInputsTableId"),n=t.getElementsByTagName("tr");Me=n[Te].cells[1].getElementsByTagName("input")[0].value},U.editPropsNodeOutputLabel=function(e){Ce=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeOutputsTableId"),n=t.getElementsByTagName("tr");ye=n[Ce].cells[1].getElementsByTagName("input")[0].value},U.editPropsNodeRefInputLabel=function(e){Le=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeRefInputsTableId"),n=t.getElementsByTagName("tr");Ee=n[Le].cells[1].getElementsByTagName("input")[0].value},U.editPropsNodeRefOutputLabel=function(e){Fe=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeRefOutputsTableId"),n=t.getElementsByTagName("tr");ke=n[Fe].cells[1].getElementsByTagName("input")[0].value},U.isEditNameInvalid=o.observable(!1),U.editNameValue=o.observable(""),U.validateNameMessage1=o.observable(""),U.validateNameMessage2=o.observable("");var Oe;U.setOldName=function(e){Oe=e},U.validateEditName=function(e){var t=U.editNameValue().trim();if(t.length>0){var n=O.getAllNames(U.flowManager.getNodeNamesMap()),o=t===Oe||O.isNewNodeNameValid(t,n);U.isEditNameInvalid(!o)}else U.isEditNameInvalid(!0);o?(U.validateNameMessage1(""),U.validateNameMessage2("")):(U.validateNameMessage1("Only alphanumericals, dots, dashes "),U.validateNameMessage2("and underscores"))},U.isLinkLabelInvalid=o.observable(!1),U.validateLinkMessage=o.observable("");var Se;U.setOldLinkLabel=function(e){Se=e},U.validateLinkLabel=function(e){var t=U.propsLinkLabel().trim();if(t.length>0){var n=O.getAllLinkLabels(U.flowManager.getLinkLabelsMap()),o=t===Se||O.isNewLinkLabelValid(t,n);U.isLinkLabelInvalid(!o)}else U.isLinkLabelInvalid(!1);o?U.validateLinkMessage(""):U.validateLinkMessage("Only alphanumericals, dots, dashes, underscores and spaces")},U.pictureURLValue=o.observable(""),U.isPictureURLInvalid=o.observable(!1),U.validatePictureURL=function(e){U.isPictureURLInvalid(!1)};var Pe=d.decisionRun().NONE,Ae=void 0;U.showNewFileName=o.observable(),U.showEditedInfo=o.observable(),U.showDecisionInfo=o.observable(),U.decisionInputPicture=o.observable(),U.decisionEndsPicture=o.observable(),U.isNodeNameInvalid=o.observable(!1),U.newNodeNameValue=o.observable(""),U.invalidNameMessage=o.observable(""),U.newDecisionInput=o.observable(g.getCurrentDecisionInput()),U.newDecisionEnds=o.observable(g.getCurrentDecisionEnds()),U.editedDecisionNodeName=o.observable("???"),U.setDecisionRun=function(e,t){if(Pe=t,t===d.decisionRun().CREATE){var n=P.getSelectedFlowType();U.showNewFileName(!0),U.showEditedInfo(!1),U.showDecisionInfo(n===d.flowType().DECISION)}else t===d.decisionRun().EDIT&&(Ae=e,g.setCurrentInput(e.getInput()),g.setCurrentEnds(e.getEnds()),U.editedDecisionNodeName(e.getName()),U.newDecisionInput(g.getCurrentDecisionInput()),U.newDecisionEnds(g.getCurrentDecisionEnds()),U.decisionInputPicture(g.getCurrentInputPicture()),U.decisionEndsPicture(g.getCurrentEndsPicture()),U.showNewFileName(!1),U.showEditedInfo(!0),U.showDecisionInfo(!0))},U.getEditedDecisionNode=function(){return Ae},U.getDecisionRun=function(){return Pe},U.validateNodeName=function(t){var n=U.newNodeNameValue().trim();P.getSelectedFlowType();if(n.length>0){var o=O.isNodeNameValid(n),i=O.getAllNames(U.flowManager.getNodeNamesMap()),a=O.isNodeNameDuplicate(n,i);if(U.isNodeNameInvalid(!o||a),o&&!a&&"Enter"===t.code)return I.proceed(U.flowManager),void e("#newNodeDialogId").dialog("close")}e("#newNodeButtonOK").button("option","disabled",U.isNodeNameInvalid()||0==n.length),o?a?U.invalidNameMessage("Duplicate name"):U.invalidNameMessage(""):U.invalidNameMessage("Only alphanumeric characters, dots, dashes, and underscores")},U.getDecisionIcon=function(){return U.updateTrigger(!U.updateTrigger()),g.getDecisionIcon()},U.resetDecisionIndices=function(){U.updateTrigger(!U.updateTrigger()),g.resetCurrentInputIndex(),g.resetCurrentEndsIndex(),U.decisionInputPicture(g.getCurrentInputPicture()),U.decisionEndsPicture(g.getCurrentEndsPicture()),U.newDecisionInput(g.getCurrentDecisionInput()),U.newDecisionEnds(g.getCurrentDecisionEnds())},U.moveDecisionInputNext=function(){U.updateTrigger(!U.updateTrigger()),g.moveInputNext(),U.newDecisionInput(g.getCurrentDecisionInput()),U.decisionInputPicture(g.getCurrentInputPicture()),U.decisionEndsPicture(g.getCurrentEndsPicture());var t=U.newNodeNameValue().trim();U.editedDecisionNodeName(K()),e("#newNodeButtonOK").button("option","disabled",U.getDecisionRun()!==d.decisionRun().EDIT&&(U.isNodeNameInvalid()||0==t.length))},U.moveDecisionInputPrev=function(){U.updateTrigger(!U.updateTrigger()),g.moveInputPrevious(),U.newDecisionInput(g.getCurrentDecisionInput()),U.decisionInputPicture(g.getCurrentInputPicture()),U.decisionEndsPicture(g.getCurrentEndsPicture());var t=U.newNodeNameValue().trim();U.editedDecisionNodeName(K()),e("#newNodeButtonOK").button("option","disabled",U.getDecisionRun()!==d.decisionRun().EDIT&&(U.isNodeNameInvalid()||0==t.length))},U.moveDecisionEndsNext=function(){U.updateTrigger(!U.updateTrigger()),g.moveEndsNext(),U.newDecisionEnds(g.getCurrentDecisionEnds()),U.decisionEndsPicture(g.getCurrentEndsPicture());var t=U.newNodeNameValue().trim();U.editedDecisionNodeName(K()),e("#newNodeButtonOK").button("option","disabled",U.getDecisionRun()!==d.decisionRun().EDIT&&(U.isNodeNameInvalid()||0==t.length))},U.moveDecisionEndsPrev=function(){U.updateTrigger(!U.updateTrigger()),g.moveEndsPrevious(),U.newDecisionEnds(g.getCurrentDecisionEnds()),U.decisionEndsPicture(g.getCurrentEndsPicture());var t=U.newNodeNameValue().trim();U.editedDecisionNodeName(K()),e("#newNodeButtonOK").button("option","disabled",U.getDecisionRun()!==d.decisionRun().EDIT&&(U.isNodeNameInvalid()||0==t.length))},U.btnFlowH2click=function(){U.changeFlowDirection(d.flow().VERTICAL)},U.btnFlowV2click=function(){U.changeFlowDirection(d.flow().HORIZONTAL)},U.changeFlowDirection=function(e){z(e)},U.isHorizontal=o.observable(!1),U.layoutModeText=o.observable(r.getLayoutModeText()),U.diagramModeText=o.observable(r.getDiagramModeText());var Ve=e("#newId"),Re=e("#openId"),Be=e("#undoId"),He=e("#redoId"),Ke=e("#findId"),ze=e("#refreshId"),We=e("#clearId"),_e=e("#leftId"),Ue=e("#rightId"),Ze=e("#deleteId"),je=e("#copyId"),Je=e("#pasteId"),qe=e("#saveId"),Xe=e("#saveAsId"),Qe=e("#btnFlowVId");e("#btnThumbnailId");U.updateWindow=function(t){U.updateTrigger(!U.updateTrigger()),U.isHorizontal(r.getFlowDirection()===d.flow().HORIZONTAL),U.layoutModeText(r.getLayoutModeText()),U.diagramModeText(r.getDiagramModeText());var n=!r.isEditMode();s.updateMenus(U),Ve.attr("disabled",n||!U.isConnectionOK()&&!U.initOK()),Re.attr("disabled",!U.isConnectionOK()&&!U.initOK()),Be.attr("disabled",n||!U.flowManager.canUndo()).attr("title",U.flowManager.getUndoName()),He.attr("disabled",n||!U.flowManager.canRedo()).attr("title",U.flowManager.getRedoName()),Ze.attr("disabled",n||!U.flowManager.getSelectionManager().hasSelections()),je.attr("disabled",n||!U.flowManager.canCopy()),Je.attr("disabled",n||!U.flowManager.readyToPaste()),qe.attr("disabled",n||!U.isConnectionOK()||!U.flowManager.isDirty()),Xe.attr("disabled",n||!U.isConnectionOK()||U.flowManager.getModelHandler().isDiagramEmpty()),ze.attr("disabled",!U.isCanvasVisible()),Ke.attr("disabled",!U.isCanvasVisible()),We.attr("disabled",n||!U.isCanvasVisible()),_e.attr("disabled",!U.flowManager.hasPreviousDiagram()),Ue.attr("disabled",!U.flowManager.hasNextDiagram()),Qe.attr("disabled",r.getAppMode()!==d.appMode().FLOW_MODE),e("#btnFlowHId").attr("disabled",n),e("#btnFlowVId").attr("disabled",n),"visible"!==document.getElementById("blockResizeId").style.visibility||ue?ue&&(document.getElementById("blockResizeId").style.visibility="hidden",ue=!1):ue=!0,"visible"!==document.getElementById("switchResizeId").style.visibility||fe?fe&&(document.getElementById("switchResizeId").style.visibility="hidden",fe=!1):fe=!0,U.flowManager.isInitialResizeMode()&&U.flowManager.getModelHandler().isDiagramEmpty()?($.spinner("enable"),Y.spinner("enable")):($.spinner("disable"),Y.spinner("disable"))};var $e=!1;U.hasFlowDirectionChange=function(){return $e},U.setFlowDirectionChange=function(){$e=!0},U.resetFlowDirectionChange=function(){$e=!1},U.initData=function(){U.updateWindow()},U.gallerySENodes=o.pureComputed(function(){return U.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getSENodesH():u.getSENodesV()}),U.galleryFlowNodes=o.pureComputed(function(){return U.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getFlowNodesH():u.getFlowNodesV()}),U.gallerySwimNodes=o.pureComputed(function(){return U.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getSwimNodesH():u.getSwimNodesV()}),U.galleryQuizNodes=o.pureComputed(function(){return U.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getQuizNodesH():u.getQuizNodesV()}),U.galleryMiscNodes=o.pureComputed(function(){return U.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getMiscNodesH():u.getMiscNodesV()}),U.pageNodes=o.pureComputed(function(){U.updateTrigger();for(var e=[],t=r.getFlowDirection()===d.flow().HORIZONTAL?u.getHPageItems():u.getVPageItems(),n=0;n<t.length;n++)e.push(t[n]);return e}),U.diagramDisplayName=o.observable(ee),U.setDiagramDisplayName=function(e){e&&e.length>0?U.diagramDisplayName(e):U.diagramDisplayName(ee)},U.aboutTitle=o.observable(""),U.aboutVersion=o.observable(""),U.aboutText=o.observable(""),U.aboutSources=o.observable(""),U.aboutCopyright=o.observable(""),U.showAboutBox=function(t,n,o,i,a){U.aboutTitle(t),U.aboutVersion(n),U.aboutText(o),U.aboutSources(i),U.aboutCopyright(a),e("#aboutDialogId").dialog("open")},U.integrationTitle=o.observable(R.getTopTitle()),U.integrationTopNotes=o.observable(R.getTopNotes()),U.integrationReactTitle=o.observable(R.getReactTitle()),U.integrationReactNotesTop=o.observable(R.getReactNotesTop()),U.integrationReactNotesBottom=o.observable(R.getReactNotesBottom()),U.integrationAngularTitle=o.observable(R.getAngularTitle()),U.integrationAngularNotesTop=o.observable(R.getAngularNotesTop()),U.infoMessage=o.observable(""),U.infoMessageVisible=o.observable(),U.showInfoMessage=function(t,n){U.infoMessage(t),U.infoMessageVisible(!1),e("#infoDialogId").dialog("open"),n&&e("#infoDialogId").dialog("option","title",n)},e("#infoDialogId").on("dialogopen",function(t,n){setTimeout(function(){U.infoMessageVisible(!0),e("#infoTextId").scrollTop(0)},200)});var Ye=e("#text1ViewDialogId");U.viewMessage1=o.observable(""),U.viewMessage1Visible=o.observable(),U.showText1ViewMessage=function(e,t){Ye.dialog("isOpen")&&Ye.dialog("close"),U.viewMessage1(e),U.viewMessage1Visible(!1),Ye.dialog("open"),t&&Ye.dialog("option","title",t)},Ye.on("dialogopen",function(t,n){setTimeout(function(){U.viewMessage1Visible(!0),e("#text1ViewId").scrollTop(0)},100)});var Ge=e("#text2ViewDialogId");U.viewMessage2=o.observable(""),U.viewMessage2Visible=o.observable(),U.showText2ViewMessage=function(e,t){Ge.dialog("isOpen")&&Ge.dialog("close"),U.viewMessage2(e),U.viewMessage2Visible(!1),Ge.dialog("open"),t&&Ge.dialog("option","title",t)},Ge.on("dialogopen",function(t,n){setTimeout(function(){U.viewMessage2Visible(!0),e("#text2ViewId").scrollTop(0)},100)});var et;U.getConfirmFlag=function(){return et},U.setConfirmFlag=function(e){et=e},U.confirmMessage=o.observable(""),U.showConfirmMessage=function(t,n,o){C.initDialog(U.flowManager),U.confirmMessage(t),n&&G.dialog("option","title",n),o&&(e(e("button",G.parent())[1]).text(o.first),e(e("button",G.parent())[2]).text(o.second)),G.dialog("open")},U.isShowThumbnail=o.observable(),U.btnThumbnailShow=function(){U.isShowThumbnail(!0),e("#thumbnailDialogId").dialog("open"),U.repaintDiagram()},U.btnThumbnailHide=function(){U.isShowThumbnail(!1),U.repaintDiagram()},U.overlayText=o.observable("");var tt=e("#saveOverlayId");U.showOverlayMessage=function(e,t){var n=t||400;U.overlayText(e),tt.show(),setTimeout(function(){tt.fadeOut(n)},n+200)};var nt;U.getDraggedPaletteId=function(){return nt},U.setDraggedPaletteId=function(e){nt=e},U.onPaletteDragStart=function(e){nt=e.target.id,e.dataTransfer.setData("text",e.target.id)},U.onPaletteDragEnd=function(e){var t=Z.getBoundingClientRect();e.clientX>t.left&&e.clientX<t.right&&e.clientY>t.top&&e.clientY<t.bottom||U.flowManager.getDnDHandler().resetDrag()},U.requestFocus=function(){},U.isControlPressed=function(){return te},U.setControlPressed=function(e){te=e},U.isEditControlPressed=function(){return oe},U.setEditControlPressed=function(e){oe=e},U.isShiftPressed=function(){return ne},U.setShiftPressed=function(e){ne=e},window.onresize=W,window.onscroll=function(){e("#thumbnailDialogId").dialog({position:{my:"right bottom",at:"right-17 bottom-4",of:window}}),e("#findDialogId").dialog({position:{my:"right top",at:"right-4 top-4",of:window}}),U.repaintDiagram()};var ot=0,it=e("#containerId");return U.repaintDiagram=function(){U.hideContainerBar(),U.hideSwitchBar(),U.flowManager.paintDiagram()},o.applyBindings(U),U.initData(),{initFlowDemo:function(){window.scrollTo(0,0),e(window).trigger("resize"),U.setProgressBarVisible(!1),r.isDemoOnly()?(U.isConnectionOK(!1),U.showOverlayMessage("No server connection",500),U.updateWindow()):r.isDevMode()?(U.isConnectionOK(!0),U.updateWindow()):(U.showOverlayMessage("Connecting to server...",3e3),i.checkMyConnection(U.flowManager))}}});