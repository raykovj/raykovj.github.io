define(["jquery","jqueryui","jqueryuictxm","knockout","modules/server/ioHandler","modules/fs/directories","modules/html/toolbar","modules/settings/config","modules/actions/frameActions","modules/graph/graphConstants","modules/gallery/components","modules/gallery/iconOptionsPicker","modules/gallery/portIconPicker","modules/gallery/cardinalityPicker","modules/gallery/decisionEnds","modules/db/dbRecords","modules/flow/flowManager","modules/fs/fsBrowser","modules/diagram/mouseInteractor","modules/dialogs/newFlowDialog","modules/dialogs/newFolderDialog","modules/dialogs/openFlowDialog","modules/dialogs/createNodeDialog","modules/dialogs/nodePropsDialog","modules/dialogs/findDialog","modules/dialogs/linkPropsDialog","modules/dialogs/aboutDialog","modules/util/welcomeText","modules/dialogs/welcomeDialog","modules/dialogs/infoDialog","modules/dialogs/confirmDialog","modules/dialogs/thumbnailDialog","modules/settings/settingsDialog","modules/dialogs/text1ViewDialog","modules/dialogs/text2ViewDialog","modules/geometry/point","modules/util/utils","modules/draw/draw","modules/controller/flowCache","modules/exportLayout/demoFlow","modules/util/integrationText"],function(e,t,n,o,i,a,s,r,l,d,u,c,g,p,b,m,f,v,I,w,h,T,N,D,y,M,C,L,x,E,k,F,P,S,O,V,A,R,B,H,W){function _(e){e===d.flow().VERTICAL?(me.removeClass("block-extendV"),me.addClass("block-extendH"),fe.removeClass("block-extendH"),fe.addClass("block-extendV"),ve.removeClass("block-shrinkV"),ve.addClass("block-shrinkH"),Ie.removeClass("block-shrinkH"),Ie.addClass("block-shrinkV")):e===d.flow().HORIZONTAL&&(me.removeClass("block-extendH"),me.addClass("block-extendV"),fe.removeClass("block-extendV"),fe.addClass("block-extendH"),ve.removeClass("block-shrinkH"),ve.addClass("block-shrinkV"),Ie.removeClass("block-shrinkV"),Ie.addClass("block-shrinkH"))}function z(e){e===d.flow().VERTICAL?(Te.removeClass("block-extendV"),Te.addClass("block-extendH"),Ne.removeClass("block-shrinkV"),Ne.addClass("block-shrinkH")):e===d.flow().HORIZONTAL&&(Te.removeClass("block-extendH"),Te.addClass("block-extendV"),Ne.removeClass("block-shrinkH"),Ne.addClass("block-shrinkV"))}function K(e){if(X.selectedFileType()===d.fileTypes().ALL)return e;var t=[],n=X.selectedFileType().split(".").pop();return e.forEach(function(e){e.split(".").pop()===n&&t.push(e)}),t}function U(){return Be?Be.getName():"[none]"}function Z(e){r.setFlowDirection(e),X.setFlowDirectionChange(),_(e),z(e),X.getFlowManager().hasDiagramOpen()&&X.flowManager.setDirty(!0),X.setConfirmFlag(d.bValue().FALSE),X.getFlowManager().setSettingsChanged(!0),setTimeout(function(){X.getFlowManager().refreshDiagramOnEdit()},200)}function j(){var e=L.getTitle(),t=L.getWelcome(),n=L.getWelcomeTo(),o=L.getText();X.showWelcomeBox(e,t,n,o)}function G(){e("#settingsDialogId").dialog({position:{my:"right top+10",at:"right top",of:"#topContainerId"}}),e("#nodePropsDialogId").dialog({position:{my:"right top+10",at:"right top",of:"#topContainerId"}}),e("#linkPropsDialogId").dialog({position:{my:"right top+10",at:"right top",of:"#topContainerId"}}),e("#thumbnailDialogId").dialog({position:{my:"right bottom",at:"right-17 bottom-4",of:window}}),e("#findDialogId").dialog({position:{my:"right top",at:"right-4 top-4",of:window}}),q(),X.repaintDiagram();var t=document.getElementById("diagramNameId").offsetLeft;document.getElementById("navbarGapId").style.marginTop=t>160?"20px":"54px"}function q(){var t=e(window).height();e(window).scrollTop();st.height(t-at)}var X=this,J=document.getElementById("canvasId"),$=document.getElementById("canvasThId"),Y=J.getContext("2d"),Q=document.getElementById("containerId"),ee=document.getElementById("topContainerId"),te=(document.getElementById("containerId"),e("#topContainerId"),e("#openFlowDialogId")),ne=e("#spinnerLevelsId"),oe=e("#spinnerLanesId"),ie=(e("#spinnerSpaceId"),e("#confirmDialogId")),ae=(e("#thumbnailDialogId"),"[select 'New' or 'Open' from menus]"),se=!1,re=!1,le=!1;X.accHdrFlowTitle=o.observable(d.appTitles().FLOW_TITLE),X.accHdrSideTitle=o.observable(d.appTitles().SIDE_TITLE),X.accHdrMiscTitle=o.observable(d.appTitles().MISC_TITLE),X.accHdrPagesTitle=o.observable(d.appTitles().PAGES_TITLE),X.accHdrBpelTitle=o.observable(d.appTitles().BPEL_TITLE),X.accHdrK8sTitle=o.observable(d.appTitles().K8S_TITLE),X.getCanvas=function(){return J},X.getCanvasTh=function(){return $},X.getCanvasContext=function(){return Y},X.getCanvasContainer=function(){return Q},X.getTopContainer=function(){return ee},X.flowManager=new f(X),X.interactor=X.flowManager.getMouseInteractor(),X.dndHandler=X.flowManager.getDnDHandler(),X.updateTrigger=o.observable(!1);var de=new v(X);X.getFlowManager=function(){return X.flowManager};var ue=Date.now(),ce=!1;X.isConnectionOK=o.observable(ce),X.cnxResultOK=function(){ce=!0,X.showOverlayMessage("Connected",500),X.isConnectionOK(ce),setTimeout(function(){X.updateWindow()},200),ce&&X.flowManager.getInstallSettings(),j()},X.cnxResultFAIL=function(e){Date.now()-ue<3e3?(ce=!1,console.log("*** connection FAIL: "+e.readyState),setTimeout(function(){X.showOverlayMessage("No server connection",500)},200)):(ce=!0,X.showOverlayMessage("Connected",500)),X.isConnectionOK(ce),setTimeout(function(){console.clear(),X.updateWindow()},200),ce&&X.flowManager.getInstallSettings(),j()},e(document).ready(function(){function t(t){return e("<img>",{style:"margin: 0 6px -2px -22px;",src:c.getIconURL(t.value)})}function n(t){return e("<img>",{style:"margin: 0 6px -2px 0;",src:c.getIconURL(t.value)})}function o(t){return e("<img>",{style:"margin: 0px 6px 2px 10px; ",src:g.getPortIconURL(t.value)})}function i(t){return e("<img>",{style:"margin: 0 6px -2px 6px; background-color: white; }",src:g.getPortIconURL(t.value)})}function a(t){return e("<img>",{style:"margin: 0 6px -2px -22px;",src:p.getCardinalityURL(t.value)})}function r(t){return e("<img>",{style:"margin: 0 6px -2px 0;",src:p.getCardinalityURL(t.value)})}Y.canvas.width=0,Y.canvas.height=0,w.initDialog(X.flowManager),h.initDialog(X.flowManager),T.initDialog(X.flowManager),P.initDialog(X.flowManager),S.initDialog(X.flowManager),O.initDialog(X.flowManager),N.initDialog(X.flowManager),D.initDialog(X.flowManager),y.initDialog(X.flowManager),M.initDialog(X.flowManager),C.initDialog(X.flowManager),E.initDialog(X.flowManager),k.initDialog(X.flowManager),F.initDialog(X.flowManager),x.initDialog(X.flowManager),s.initButtons(X),l.initActions(X),e("#canvasId").contextmenu(X.interactor.getContextMenu()),ee.addEventListener("mousemove",function(t){X.interactor.isOverCanvas(t)||(e("#canvasId").contextmenu("close"),X.flowManager.getFlowDiagram().setMousePoint(void 0))}),ee.addEventListener("mousedown",function(e){}),e("#paletteCtrId").show(),e("#paletteAccordionId").accordion({heightStyle:"fill",animate:{easing:"swing",duration:200},collapsible:!0,activate:function(e,t){X.updateWindow()}}),e("#accTableMiscsId").height(158),e("#accTableFlowId").height(210),e("#settingsTabId").tabs({}),e("#integrationTabId").tabs({}),e("#nodePropsTabId").tabs({activate:function(t,n){1===n.newTab.index()?e("#nodePropsTabId").css({overflow:"auto"}):e("#nodePropsTabId").css({overflow:"hidden"})}}),e("#infoTextId").attr("visibility","hidden"),ne.spinner({step:1,min:d.canvasRange().MIN,max:d.canvasRange().MAX,numberFormat:"n"}),ne.spinner("value",d.initial().LEVELS),ne.spinner("enable"),oe.spinner({step:1,min:d.canvasRange().MIN,max:d.canvasRange().MAX,numberFormat:"n"}),oe.spinner("value",d.initial().LANES),oe.spinner("enable");var u=e("#progressBarId");u.progressbar({value:!1}),u.height(14),e.widget("nodeIcons.iconselectmenu",e.ui.selectmenu,{_renderButtonItem:function(t){var o=e("<div>",{text:c.getIconLabel(t.value)});return n(t).prependTo(o),o},_renderItem:function(n,o){var i=e("<li>"),a=e("<div>",{text:c.getIconLabel(o.value)});return t(o).prependTo(a),i.append(a).appendTo(n)},_renderMenu:function(t,n){var o=this,i=c.getOptionItems(n);e.each(i,function(e,n){o._renderItemData(t,n)})},refreshButtonItem:function(e,t){var n=c.getIndexValue(e,t);this.element[0].selectedIndex=n,this.refresh()}}),e("#nodeIconItemsId").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons customicons"),e("#settingIconItemsId").iconselectmenu().iconselectmenu("menuWidget").addClass("ui-menu-icons customicons"),e.widget("portImages.porticonmenu",e.ui.selectmenu,{_renderButtonItem:function(t){var n=e("<div>",{style:"padding-left: 16px; height: 16px; width: 100px; background-color: white"});return o(t).prependTo(n),n},_renderItem:function(t,n){var o=e("<li>"),a=e("<div>",{style:"height: 16px; width: 120px"});return i(n).prependTo(a),o.append(a).appendTo(t)},_renderMenu:function(t,n){var o=this,i=g.getPortOptionItems(n);e.each(i,function(e,n){o._renderItemData(t,n)})},refreshButtonItem:function(e){var t=g.getPortIndexValue(e);this.element[0].selectedIndex=t,this.refresh()}}),e("#selectPortIconsId").porticonmenu().porticonmenu("menuWidget").addClass("ui-menu-icons porticons"),e.widget("ports.portcardinalitymenu",e.ui.selectmenu,{_renderButtonItem:function(t){var n=e("<div>",{text:p.getCardinalityLabel(t.value)});return r(t).prependTo(n),n},_renderItem:function(t,n){var o=e("<li>"),i=e("<div>",{text:p.getCardinalityLabel(n.value)});return a(n).prependTo(i),o.append(i).appendTo(t)},_renderMenu:function(t,n){var o=this,i=p.getCardinalityItems(n);e.each(i,function(e,n){o._renderItemData(t,n)})},refreshButtonItem:function(e,t){var n=p.getCardinalityIndex(e,t);this.element[0].selectedIndex=n,this.refresh()}}),e("#selectPartitionId").selectmenu({select:function(e,t){if(e.currentTarget){var n=e.currentTarget.textContent;console.log("$$$ disk select: "+n),X.selectedPartition(n)}},change:function(e,t){var n=e.currentTarget.textContent;console.log("### disk change: "+n)},create:function(e,t){setTimeout(function(){X.flowManager.getDiskNames()},1e3)}}).addClass("settingsDiskMenu").css("fontSize","16px"),e("#selectFileTypeId").selectmenu({create:function(t,n){setTimeout(function(){X.selectedFileType(d.fileTypes().JSON),e("#selectFileTypeId").selectmenu("refresh")},1e3)},select:function(e,t){if(e.currentTarget){var n=e.currentTarget.textContent;X.selectedFileType(n),X.flowManager.getDirContent()}}}).addClass("settingsDiskMenu"),e.widget("demomenu.demofilesmenu",e.ui.selectmenu,{_renderButtonItem:function(t){return e("<div>",{text:t.label?t.label:X.flowManager.getDemoList()[0].label})}}),e("#selectFileId").demofilesmenu().demofilesmenu("menuWidget").addClass("ui-menu-icons demofiles")}),X.isAutoLayoutAllowed=o.observable(r.isAllowAuto()),X.forceTestAutoMode=function(e){r.setLayoutMode(d.layoutMode().AUTO),X.flowManager.getSelectionManager().clearSelections(),X.flowManager.resetScale(),X.runTestAutoMode()},X.resetTestAutoMode=function(){X.flowManager.clearDiagram(),r.setLayoutMode(d.layoutMode().MANUAL)},X.runTestAutoMode=function(){},X.nodeEmojiItems=o.pureComputed(function(){return c.getNodeIconOptions()}),X.portIcons=o.pureComputed(function(){return g.getPortIconOptions()}),X.cardinalityItems=o.pureComputed(function(){return p.getCardinalityList()}),X.enableShowCardinality=o.observable(!1),X.setEnableShowCardinality=function(e){X.enableShowCardinality(e)},X.enableShowDB=o.observable(!1),X.setEnableShowDB=function(e){X.enableShowDB(e)},X.demoFilesItems=o.pureComputed(function(){return X.flowManager.getDemoList()}),X.nodeActionsList=o.pureComputed(function(){return D.getActionsList()}),X.nodeOperationsList=o.pureComputed(function(){return D.getOperationsList()}),X.nodeServicesList=o.pureComputed(function(){return D.getServicesList()}),X.nodePublishList=o.pureComputed(function(){return D.getPublishList()}),X.nodeSubscribeList=o.pureComputed(function(){return D.getSubscribeList()}),X.onOpsActionChange=function(e){},X.isProgressBarVisible=o.observable(!1),X.isProgressBarVisible.extend({notify:"always"}),X.setProgressBarVisible=function(e){X.isProgressBarVisible(e)},setTimeout(function(){e("#paletteAccordionId").accordion("option","icons",{header:"ui-icon-triangle-1-e",activeHeader:"ui-icon-triangle-1-s"})},100),X.showPageMode=o.observable(r.hasPageMode()),X.isCanvasVisible=o.observable(!1),X.setCanvasVisible=function(e){X.isCanvasVisible(e)},X.scaleValue=o.observable(r.getScale());var ge=document.getElementById("scaleId");ge.oninput=function(){r.setScale(this.value/d.scale().FACTOR),X.scaleValue(r.getScale()),X.flowManager.clearClipboard(),X.flowManager.getFlowDiagram().clearCanvas(),X.flowManager.paintDiagram()},ge.onchange=function(){X.flowManager.refreshDiagramOnEdit()},X.editModeText=o.observable(r.isEditMode()?d.editModeText().EDIT:d.editModeText().VIEW),X.setEditModeText=function(e){e===d.editMode().EDIT_ALL?X.editModeText(d.editModeText().EDIT):X.editModeText(d.editModeText().VIEW)},X.setTooltipBox=function(e,t){e.length>0&&r.isEditMode()&&R.drawTooltip(Y,J.getBoundingClientRect(),t,e)},X.showTooltipBox=function(e){},X.getCurrentFileName=function(){var e=X.flowManager.getFileName(),t=e.indexOf(".json");return e.substring(0,t)};var pe,be=document.getElementById("blockResizeId"),me=e("#extendBlockAcrossId"),fe=e("#extendBlockAlongId"),ve=e("#shrinkBlockAcrossId"),Ie=e("#shrinkBlockAlongId");X.showBlockResizeBar=function(e){var t=e.getExpandedShape(),n=r.getScale();be.style.left=J.getBoundingClientRect().left+t.x*n+"px",be.style.top=J.getBoundingClientRect().top+t.y*n-24+"px",me.attr("disabled",!r.isEditMode()||!e.canExtendAcross()),fe.attr("disabled",!r.isEditMode()||!e.canExtendAlong()),ve.attr("disabled",!r.isEditMode()||!e.canShrinkAcross()),Ie.attr("disabled",!r.isEditMode()||!e.canShrinkAlong()),be.style.visibility="visible"},X.doResizeContainer=function(e){var t=X.getFlowManager().getSelectionManager().getSelections();t[0].getFlowType()===d.flowType().CONTAINER&&t[0].resizeOutline(e),be.style.visibility="hidden",pe=!1},X.isBlockResizeBarVisible=function(){return pe},X.hideContainerBar=function(){be.style.visibility="hidden"};var we,he=document.getElementById("switchResizeId"),Te=e("#extendSwitchAcrossId"),Ne=e("#shrinkSwitchAcrossId");X.showSwitchResizeBar=function(e){var t=e.getMenuBarPosition(),n=r.getScale();he.style.left=J.getBoundingClientRect().left+t.x*n+"px",he.style.top=J.getBoundingClientRect().top+t.y*n-24+"px",Te.attr("disabled",!r.isEditMode()||!e.canExtendAcross()),Ne.attr("disabled",!r.isEditMode()||!e.canShrinkAcross()),he.style.visibility="visible"},X.doResizeSwitch=function(e){var t=X.getFlowManager().getSelectionManager().getSelections();t[0].getFlowType()===d.flowType().SWITCH&&t[0].resizeOutline(e),he.style.visibility="hidden",we=!1},X.isSwitchResizeBarVisible=function(){return we},X.hideSwitchBar=function(){he.style.visibility="hidden"},X.showSearchList=o.observable(!1),X.showFindOptions=o.observable(!0),X.searchContentList=o.observableArray(),X.foundMatches=o.observable(),X.onFindTableClick=function(e){var t=e.target.innerText;y.selectedNewDisk(t)},X.onFindTableDblClick=function(e){X.onFindTableClick(e)},X.onPasteSearchText=function(e){y.selectedNewDisk(label)},X.currentPath=o.observable(),X.fsContentList=o.observableArray(),X.selectedPath=o.observable(),X.isOpenMode=o.observable(),X.isSaveMode=o.observable(),X.showPartitions=o.observable(!1),X.partitionsList=o.observableArray([""]),X.selectedPartition=o.observable(),X.filesTypes=o.observableArray([d.fileTypes().JSON,d.fileTypes().ALL]),X.selectedFileType=o.observable(d.fileTypes().JSON);X.callOpenFlowDialog=function(){X.isConnectionOK()?te.dialog({height:440}):te.dialog({height:180}),X.flowManager.getRootDir(),te.dialog("open")},X.onDiskTableClick=function(e){var t=e.target.innerText;T.selectedNewDisk(t)},X.setFSDialogMode=function(e){de.setFSDialogMode(e)},X.getFSDialogMode=function(){return de.getFSDialogMode()},X.restoreWorkDir=function(){de.restoreWorkDir()},X.setWorkDir=function(e){de.setWorkDir(e)},X.getWorkDir=function(){return de.getWorkDir()},X.getSelectedFSDir=function(){return de.getSelectedFSDir()},X.getSelectedFSFile=function(){return de.getSelectedFSFile()},X.onDirTableClick=function(e){de.onDirTableClick(e)},X.deleteFSItem=function(){de.deleteFSItem()},X.onDirTableDblClick=function(e){de.onDirTableDblClick(e)},X.updateMainFSLocation=function(){de.updateMainFSLocation()},X.goOneDirBack=function(){de.goOneDirBack()},X.setDirsList=function(e,t){de.setDirsList(e,t)},X.setFolderContent=function(e,t){de.setFolderContent(e,t)},X.onFileTypeChange=function(e){de.onFileTypeChange(e)},X.showForegroundSelection=o.observable(!0),X.showBackgroundSelection=o.observable(!0),X.settingsSchemes=o.pureComputed(function(){return X.flowManager.getSettingsManager().getColorsSchemesList()});var De;X.setNewAction=function(e){De=e},X.isNewAction=function(){return De},X.filesList=o.observableArray();var ye=[];X.setFilesList=function(t){if(ye=t,X.filesList(t),X.filesList(K(t)),De)e("#newFlowDialogId").dialog("open");else;},X.selectedFile=o.observable(),X.getSelectedFile=function(){return X.isConnectionOK()?_selectedFile:X.selectedFile()},X.isInputInvalid=o.observable(!1),X.validateMessage=o.observable(""),X.newFSNameValue=o.observable(""),X.nameValueEmpty=o.observable(""),X.validateFSName=function(t,n){var o=X.newFSNameValue().trim(),i=n?a.getDirectoriesLabels():X.filesList();X.nameValueEmpty(0===o.length);var s=X.isInputInvalid(),r=A.containsFSName(i,o),l=A.isFSNameValid(X.newFSNameValue()),d=o.length>0&&(!l||r);X.isInputInvalid(d),s&&!d&&(e("#newFileNameId").blur(),e("#newFileNameId").focus()),e("#newFlowButtonOK").button("option","disabled",X.isInputInvalid()||X.nameValueEmpty()),e("#newFolderButtonOK").button("option","disabled",X.isInputInvalid()||X.nameValueEmpty()),l?r?X.validateMessage("Duplicate name"):X.validateMessage(""):X.validateMessage("Only alphanumeric characters, dots, dashes, and underscores"),t&&o.length>0&&l&&"Enter"===t.code&&(De?(w.createNewDiagram(X.flowManager),e("#newFlowDialogId").dialog("close")):(h.createNewFolder(X.flowManager),e("#newFolderDialogId").dialog("close")))},e("#newFlowDialogId").on("dialogopen",function(e,t){X.validateFSName()}),e("#newFlowDialogId").on("dialogclose",function(e,t){X.newFSNameValue("")}),X.saveAsInputInvalid=o.observable(!1),X.saveAsMessage=o.observable(""),X.saveAsFileNameValue=o.observable(""),X.saveAsNameEmpty=o.observable(""),X.validateSaveAsFileName=function(t){var n=X.saveAsFileNameValue().trim();X.saveAsNameEmpty(0===n.length);var o=X.saveAsInputInvalid(),i=n!==X.getCurrentFileName()&&A.containsFSName(X.filesList(),n),a=A.isFSNameValid(X.saveAsFileNameValue()),s=n.length>0&&(!a||i);X.saveAsInputInvalid(s),o&&!s&&(e("#saveAsFileNameId").blur(),e("#saveAsFileNameId").focus()),e("#saveAsButtonSave").button("option","disabled",X.saveAsInputInvalid()||X.saveAsNameEmpty()),a?i?X.saveAsMessage("Duplicate name"):X.saveAsMessage(""):X.saveAsMessage("Only alphanumeric characters, dots, dashes, and underscores"),n.length>0&&a&&t.code};var Me=o.observable();X.propsLinkSourceName=o.observable(),X.propsLinkSourceLabel=o.observable(),X.propsLinkTargetName=o.observable(),X.propsLinkTargetLabel=o.observable(),X.propsLinkLabel=o.observable(),X.getPropsLink=function(){return Me()},X.getPropsLinkLabelValue=function(){return X.propsLinkLabel()},X.showLinkProps=function(t){Me(t),X.propsLinkSourceName(Me().getLinkSourcePortName()),X.propsLinkSourceLabel(Me().getLinkSourcePortLabel()),X.propsLinkTargetName(Me().getLinkTargetPortName()),X.propsLinkTargetLabel(Me().getLinkTargetPortLabel()),X.propsLinkLabel(Me().getLinkLabel()),e("#linkPropsDialogId").dialog("open")},X.editPropsLinkLabel=function(e){X.propsLinkLabel(document.getElementById("propsLinkLabelId").value)},X.propsFgndVisible=o.observable(!0),X.setPropsFgndVisible=function(e){X.propsFgndVisible(e)},X.propsNodeInputs=o.observableArray();var Ce,Le;X.getPropsNodeInputsIdx=function(){return Ce},X.getPropsNodeInputsValue=function(){return Le},X.propsNodeOutputs=o.observableArray();var xe,Ee;X.getPropsNodeOutputsIdx=function(){return xe},X.getPropsNodeOutputsValue=function(){return Ee},X.propsNodeRefInputs=o.observableArray();var ke,Fe;X.getPropsNodeRefInputsIdx=function(){return ke},X.getPropsNodeRefInputsValue=function(){return Fe},X.propsNodeRefOutputs=o.observableArray();var Pe,Se;X.getPropsNodeRefOutputsIdx=function(){return Pe},X.getPropsNodeRefOutputsValue=function(){return Se},X.isCardinalitySelected=o.observable(!0);var Oe=o.observable();X.getPropsNode=function(){return Oe()},X.showNodeProps=function(t){Oe(t),c.setNodeCategory(t.getNodeCategory()),X.propsNodeInputs(Oe().getInputPortsProperties()),X.propsNodeOutputs(Oe().getOutputPortsProperties()),X.propsNodeRefInputs(Oe().getRefInPortsProperties()),X.propsNodeRefOutputs(Oe().getRefOutPortsProperties()),X.dbNodeRecords(Oe().getDBRecords()),e("#nodePropsDialogId").dialog("open")},X.editPropsNodeInputLabel=function(e){Ce=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeInputsTableId"),n=t.getElementsByTagName("tr");Le=n[Ce].cells[2].getElementsByTagName("input")[0].value},X.checkPortInputCardinality=function(e){D.editPortInputCardinality(e)},X.editPropsNodeOutputLabel=function(e){xe=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeOutputsTableId"),n=t.getElementsByTagName("tr");Ee=n[xe].cells[2].getElementsByTagName("input")[0].value},X.checkPortOutputCardinality=function(e){D.editPortOutputCardinality(e)},X.editPropsNodeRefInputLabel=function(e){ke=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeRefInputsTableId"),n=t.getElementsByTagName("tr");Fe=n[ke].cells[2].getElementsByTagName("input")[0].value},X.checkPortRefInputCardinality=function(e){D.editPortRefInputCardinality(e)},X.editPropsNodeRefOutputLabel=function(e){Pe=e.target.parentNode.parentNode.rowIndex;var t=document.getElementById("nodeRefOutputsTableId"),n=t.getElementsByTagName("tr");Se=n[Pe].cells[2].getElementsByTagName("input")[0].value},X.checkPortRefOutputCardinality=function(e){D.editPortRefOutputCardinality(e)},X.dbNodeRecords=o.observableArray();X.dbTableErrorMsg=o.observable(!1),X.editNodeTableKey=function(e){D.processTableClickKey(e)},X.editNodeTableField=function(e){D.processTableClickField(e)},X.editNodeTableType=function(e){D.processTableClickType(e)},X.editNodeTableLength=function(e){D.processTableClickLength(e)},X.isEditNameInvalid=o.observable(!1),X.editNameValue=o.observable(""),X.validateNameMessage=o.observable("");var Ve;X.setOldName=function(e){Ve=e},X.validateEditName=function(e){var t=X.editNameValue().trim();if(t.length>0){var n=A.getAllNames(X.flowManager.getNodeNamesMap()),o=A.isDuplicateName(Ve,t,n),i=A.isNewNodeNameValid(t),a=!o&&i;X.isEditNameInvalid(!a)}else X.isEditNameInvalid(!0);o?X.validateNameMessage("Duplicate name"):i?X.validateNameMessage(""):X.validateNameMessage("Name should contain only alphanumericals, dots, dashes and underscores")},X.isLinkLabelInvalid=o.observable(!1),X.validateLinkMessage=o.observable("");var Ae;X.setOldLinkLabel=function(e){Ae=e},X.validateLinkLabel=function(e){var t=X.propsLinkLabel().trim();if(t.length>0){var n=A.getAllLinkLabels(X.flowManager.getLinkLabelsMap()),o=A.isDuplicateLabel(Ae,t,n),i=t===Ae||A.isNewLinkLabelValid(t),a=!o&&i;X.isLinkLabelInvalid(!a)}else X.isLinkLabelInvalid(!1);o?X.validateLinkMessage("Duplicate label"):i?X.validateLinkMessage(""):X.validateLinkMessage("Label should contain only alphanumericals, dots, dashes, underscores and spaces")},X.pictureURLValue=o.observable(""),X.isPictureURLInvalid=o.observable(!1),X.validatePictureURL=function(e){X.isPictureURLInvalid(!1)};var Re=d.decisionRun().NONE,Be=void 0;X.showNewFileName=o.observable(),X.showEditedInfo=o.observable(),X.showDecisionInfo=o.observable(),X.decisionInputPicture=o.observable(),X.decisionEndsPicture=o.observable(),X.isNodeNameInvalid=o.observable(!1),X.newNodeNameValue=o.observable(""),X.invalidNameMessage=o.observable(""),X.newDecisionInput=o.observable(b.getCurrentDecisionInput()),X.newDecisionEnds=o.observable(b.getCurrentDecisionEnds()),X.editedDecisionNodeName=o.observable("???"),X.setDecisionRun=function(e,t){if(Re=t,t===d.decisionRun().CREATE){var n=B.getSelectedFlowType();X.showNewFileName(!0),X.showEditedInfo(!1),X.showDecisionInfo(n===d.flowType().DECISION)}else t===d.decisionRun().EDIT&&(Be=e,b.setCurrentInput(e.getInput()),b.setCurrentEnds(e.getEnds()),X.editedDecisionNodeName(e.getName()),X.newDecisionInput(b.getCurrentDecisionInput()),X.newDecisionEnds(b.getCurrentDecisionEnds()),X.decisionInputPicture(b.getCurrentInputPicture()),X.decisionEndsPicture(b.getCurrentEndsPicture()),X.showNewFileName(!1),X.showEditedInfo(!0),X.showDecisionInfo(!0))},X.getEditedDecisionNode=function(){return Be},X.getDecisionRun=function(){return Re},X.validateNodeName=function(t){var n=X.newNodeNameValue().trim();B.getSelectedFlowType();if(n.length>0){var o=A.isNodeNameValid(n),i=A.getAllNames(X.flowManager.getNodeNamesMap()),a=A.isNodeNameDuplicate(n,i);if(X.isNodeNameInvalid(!o||a),o&&!a&&"Enter"===t.code)return N.proceed(X.flowManager),void e("#newNodeDialogId").dialog("close")}e("#newNodeButtonOK").button("option","disabled",X.isNodeNameInvalid()||0==n.length),o?a?X.invalidNameMessage("Duplicate name"):X.invalidNameMessage(""):X.invalidNameMessage("Only alphanumeric characters, dots, dashes, and underscores")},X.getDecisionIcon=function(){return X.updateTrigger(!X.updateTrigger()),b.getDecisionIcon()},X.resetDecisionIndices=function(){X.updateTrigger(!X.updateTrigger()),b.resetCurrentInputIndex(),b.resetCurrentEndsIndex(),X.decisionInputPicture(b.getCurrentInputPicture()),X.decisionEndsPicture(b.getCurrentEndsPicture()),X.newDecisionInput(b.getCurrentDecisionInput()),X.newDecisionEnds(b.getCurrentDecisionEnds())},X.moveDecisionInputNext=function(){X.updateTrigger(!X.updateTrigger()),b.moveInputNext(),X.newDecisionInput(b.getCurrentDecisionInput()),X.decisionInputPicture(b.getCurrentInputPicture()),X.decisionEndsPicture(b.getCurrentEndsPicture());var t=X.newNodeNameValue().trim();X.editedDecisionNodeName(U()),e("#newNodeButtonOK").button("option","disabled",X.getDecisionRun()!==d.decisionRun().EDIT&&(X.isNodeNameInvalid()||0==t.length))},X.moveDecisionInputPrev=function(){X.updateTrigger(!X.updateTrigger()),b.moveInputPrevious(),X.newDecisionInput(b.getCurrentDecisionInput()),X.decisionInputPicture(b.getCurrentInputPicture()),X.decisionEndsPicture(b.getCurrentEndsPicture());var t=X.newNodeNameValue().trim();X.editedDecisionNodeName(U()),e("#newNodeButtonOK").button("option","disabled",X.getDecisionRun()!==d.decisionRun().EDIT&&(X.isNodeNameInvalid()||0==t.length))},X.moveDecisionEndsNext=function(){X.updateTrigger(!X.updateTrigger()),b.moveEndsNext(),X.newDecisionEnds(b.getCurrentDecisionEnds()),X.decisionEndsPicture(b.getCurrentEndsPicture());var t=X.newNodeNameValue().trim();X.editedDecisionNodeName(U()),e("#newNodeButtonOK").button("option","disabled",X.getDecisionRun()!==d.decisionRun().EDIT&&(X.isNodeNameInvalid()||0==t.length))},X.moveDecisionEndsPrev=function(){X.updateTrigger(!X.updateTrigger()),b.moveEndsPrevious(),X.newDecisionEnds(b.getCurrentDecisionEnds()),X.decisionEndsPicture(b.getCurrentEndsPicture());var t=X.newNodeNameValue().trim();X.editedDecisionNodeName(U()),e("#newNodeButtonOK").button("option","disabled",X.getDecisionRun()!==d.decisionRun().EDIT&&(X.isNodeNameInvalid()||0==t.length))},X.btnFlowH2click=function(){X.changeFlowDirection(d.flow().VERTICAL)},X.btnFlowV2click=function(){X.changeFlowDirection(d.flow().HORIZONTAL)},X.changeFlowDirection=function(e){Z(e)},X.isHorizontal=o.observable(!1),X.layoutModeText=o.observable(r.getLayoutModeText()),X.diagramModeText=o.observable(r.getDiagramModeText());var He=(e("#newId"),e("#openId"),e("#importId")),We=e("#undoId"),_e=e("#redoId"),ze=e("#findId"),Ke=e("#refreshId"),Ue=e("#clearId"),Ze=e("#leftId"),je=e("#rightId"),Ge=e("#deleteId"),qe=e("#copyId"),Xe=e("#pasteId"),Je=e("#saveId"),$e=e("#saveAsId"),Ye=e("#btnFlowVId");e("#btnThumbnailId");X.updateWindow=function(t){X.updateTrigger(!X.updateTrigger()),X.isHorizontal(r.getFlowDirection()===d.flow().HORIZONTAL),X.layoutModeText(r.getLayoutModeText()),X.diagramModeText(r.getDiagramModeText());var n=!r.isEditMode();s.updateMenus(X),He.attr("disabled",!X.isConnectionOK()),We.attr("disabled",n||!X.flowManager.canUndo()).attr("title",X.flowManager.getUndoName()),_e.attr("disabled",n||!X.flowManager.canRedo()).attr("title",X.flowManager.getRedoName()),Ge.attr("disabled",n||!X.flowManager.getSelectionManager().hasSelections()),qe.attr("disabled",n||!X.flowManager.canCopy()),Xe.attr("disabled",n||!X.flowManager.readyToPaste()),Je.attr("disabled",n||!X.isConnectionOK()||!X.flowManager.isDirty()),$e.attr("disabled",n||!X.isConnectionOK()||X.flowManager.getModelHandler().isDiagramEmpty()),Ke.attr("disabled",!X.isCanvasVisible()),ze.attr("disabled",!X.isCanvasVisible()),Ue.attr("disabled",n||!X.isCanvasVisible()),Ze.attr("disabled",!X.flowManager.hasPreviousDiagram()),je.attr("disabled",!X.flowManager.hasNextDiagram()),Ye.attr("disabled",r.getAppMode()!==d.appMode().FLOW_MODE),e("#btnFlowHId").attr("disabled",n),e("#btnFlowVId").attr("disabled",n),"visible"!==document.getElementById("blockResizeId").style.visibility||pe?pe&&(document.getElementById("blockResizeId").style.visibility="hidden",pe=!1):pe=!0,"visible"!==document.getElementById("switchResizeId").style.visibility||we?we&&(document.getElementById("switchResizeId").style.visibility="hidden",we=!1):we=!0,X.flowManager.isInitialResizeMode()&&X.flowManager.getModelHandler().isDiagramEmpty()?(ne.spinner("enable"),oe.spinner("enable")):(ne.spinner("disable"),oe.spinner("disable"))};var Qe=!1;X.hasFlowDirectionChange=function(){return Qe},X.setFlowDirectionChange=function(){Qe=!0},X.resetFlowDirectionChange=function(){Qe=!1},X.initData=function(){X.updateWindow()},X.galleryFlowNodes=o.pureComputed(function(){return X.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getFlowNodesH():u.getFlowNodesV()}),X.galleryMiscNodes=o.pureComputed(function(){return X.updateTrigger(),r.getFlowDirection()===d.flow().HORIZONTAL?u.getMiscNodesH():u.getMiscNodesV()}),X.pageNodes=o.pureComputed(function(){X.updateTrigger();for(var e=[],t=r.getFlowDirection()===d.flow().HORIZONTAL?u.getHPageItems():u.getVPageItems(),n=0;n<t.length;n++)e.push(t[n]);return e}),X.diagramDisplayName=o.observable(ae),X.setDiagramDisplayName=function(e){e&&e.length>0?X.diagramDisplayName(e):X.diagramDisplayName(ae)},X.aboutTitle=o.observable(""),X.aboutVersion=o.observable(""),X.aboutText=o.observable(""),X.aboutSources=o.observable(""),X.aboutCopyright=o.observable(""),X.showAboutBox=function(t,n,o,i,a){X.aboutTitle(t),X.aboutVersion(n),X.aboutText(o),X.aboutSources(i),X.aboutCopyright(a),e("#aboutDialogId").dialog("open")},X.welcomeTitle=o.observable(""),X.welcomeGreeting=o.observable(""),X.welcomeTo=o.observable(""),X.welcomeTip=o.observable(""),X.showWelcomeBox=function(t,n,o,i){X.welcomeTitle(t),X.welcomeGreeting(n),X.welcomeTo(o),X.welcomeTip(i),e("#welcomeDialogId").dialog("open")},X.integrationTitle=o.observable(W.getTopTitle()),X.integrationTopNotes=o.observable(W.getTopNotes()),X.integrationReactTitle=o.observable(W.getReactTitle()),X.integrationReactNotesTop=o.observable(W.getReactNotesTop()),X.integrationReactNotesBottom=o.observable(W.getReactNotesBottom()),X.integrationAngularTitle=o.observable(W.getAngularTitle()),X.integrationAngularNotesTop=o.observable(W.getAngularNotesTop()),X.infoMessage=o.observable(""),X.infoMessageVisible=o.observable(),X.showInfoMessage=function(t,n){X.infoMessage(t),X.infoMessageVisible(!1),e("#infoDialogId").dialog("open"),n&&e("#infoDialogId").dialog("option","title",n)},e("#infoDialogId").on("dialogopen",function(t,n){setTimeout(function(){X.infoMessageVisible(!0),e("#infoTextId").scrollTop(0)},200)});var et=e("#text1ViewDialogId");X.viewMessage1=o.observable(""),X.viewMessage1Visible=o.observable(),X.showText1ViewMessage=function(e,t){et.dialog("isOpen")&&et.dialog("close"),X.viewMessage1(e),X.viewMessage1Visible(!1),et.dialog("open"),t&&et.dialog("option","title",t)},et.on("dialogopen",function(t,n){setTimeout(function(){
X.viewMessage1Visible(!0),e("#text1ViewId").scrollTop(0)},100)});var tt=e("#text2ViewDialogId");X.viewMessage2=o.observable(""),X.viewMessage2Visible=o.observable(),X.showText2ViewMessage=function(e,t){tt.dialog("isOpen")&&tt.dialog("close"),X.viewMessage2(e),X.viewMessage2Visible(!1),tt.dialog("open"),t&&tt.dialog("option","title",t)},tt.on("dialogopen",function(t,n){setTimeout(function(){X.viewMessage2Visible(!0),e("#text2ViewId").scrollTop(0)},100)});var nt;X.getConfirmFlag=function(){return nt},X.setConfirmFlag=function(e){nt=e},X.confirmMessage=o.observable(""),X.showConfirmMessage=function(t,n,o){k.initDialog(X.flowManager),X.confirmMessage(t),n&&ie.dialog("option","title",n),o&&(e(e("button",ie.parent())[1]).text(o.first),e(e("button",ie.parent())[2]).text(o.second)),ie.dialog("open")},X.isShowThumbnail=o.observable(),X.btnThumbnailShow=function(){X.isShowThumbnail(!0),e("#thumbnailDialogId").dialog("open"),X.repaintDiagram()},X.btnThumbnailHide=function(){X.isShowThumbnail(!1),X.repaintDiagram()},X.overlayText=o.observable("");var ot=e("#saveOverlayId");X.showOverlayMessage=function(e,t){var n=t||400;X.overlayText(e),ot.show(),setTimeout(function(){ot.fadeOut(n)},n+200)};var it;X.getDraggedPaletteId=function(){return it},X.setDraggedPaletteId=function(e){it=e},X.onPaletteDragStart=function(e){it=e.target.id,e.dataTransfer.setData("text",e.target.id)},X.onPaletteDragEnd=function(e){var t=J.getBoundingClientRect();e.clientX>t.left&&e.clientX<t.right&&e.clientY>t.top&&e.clientY<t.bottom||X.flowManager.getDnDHandler().resetDrag()},X.requestFocus=function(){},X.isControlPressed=function(){return se},X.setControlPressed=function(e){se=e},X.isEditControlPressed=function(){return le},X.setEditControlPressed=function(e){le=e},X.isShiftPressed=function(){return re},X.setShiftPressed=function(e){re=e},window.onresize=G,window.onscroll=function(){document.getElementById("navbarId").style.top="0";var t=document.getElementById("diagramNameId").offsetLeft;document.getElementById("navbarGapId").style.marginTop=t>160?"20px":"54px",e("#thumbnailDialogId").dialog({position:{my:"right bottom",at:"right-17 bottom-4",of:window}}),e("#findDialogId").dialog({position:{my:"right top",at:"right-4 top-4",of:window}}),X.repaintDiagram()};var at=0,st=e("#containerId");return X.repaintDiagram=function(){X.hideContainerBar(),X.hideSwitchBar(),X.flowManager.paintDiagram()},o.applyBindings(X),X.initData(),{initFlowDemo:function(){window.scrollTo(0,0),e(window).trigger("resize"),X.setProgressBarVisible(!1),X.showOverlayMessage("Connecting to server...",1e3),i.checkServerConnection(X.flowManager)}}});