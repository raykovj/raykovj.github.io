define("modules/view/dndTracker",["modules/geometry/point","modules/graph/graphConstants","modules/settings/config","modules/diagram/diagramUtils","modules/flow/flowUtils"],function(e,t,r,o,n){function g(e){var g=this,i=e,l=t.dragMode().NONE,a=void 0;g.setDragMode=function(e){l=e},g.getDragMode=function(){return l},g.setGalleryIcon=function(e){a=e},g.getGalleryIcon=function(){return a},g.clearTracking=function(){l=t.dragMode().NONE,g.resetNodesDNDFlags()},g.isSegmentDropAllowed=function(e,r,o,g,l,a){var d,s,f,p,u,c=i.getFlowLayout().getLevels(),T=i.getFlowLayout().getLanes();if(l.getType()===t.pipeType().LEVEL_PIPE){f=n.getLaneIndexAtPoint(o,T),p=n.getLaneIndexAtPoint(g,T),d=l.getOrder(),s=a.getOrder(),d>s?d--:s--;var w=Math.min(d,s),P=Math.max(d,s);for(u=w;u<=P;u++)if(f>=0&&c[u].getCellAtLane(f)||p>=0&&c[u].getCellAtLane(p))return!1}else if(l.getType()===t.pipeType().LANE_PIPE){d=n.getLevelIndexAtPoint(o,c),s=n.getLevelIndexAtPoint(g,c),f=l.getOrder(),p=a.getOrder(),f>p?f--:p--;var y=Math.min(f,p),O=Math.max(f,p);for(u=y;u<=O;u++)if(d>=0&&T[u].getCellAtLevel(d)||s>=0&&T[u].getCellAtLevel(s))return!1}var m=e.getSegments();for(u=0;u<m.length;u++)if(m[u].getOrder()!==r.getOrder()&&m[u].getType()===t.segmentType().IN_PIPE){if(m[u].getPipe().equals(a))return!1;if(m[u].getPipe().getType()===l.getType()){if(a.getOrder()>l.getOrder()&&m[u].getPipe().getOrder()>l.getOrder()&&a.getOrder()>m[u].getPipe().getOrder())return!1;if(a.getOrder()<l.getOrder()&&m[u].getPipe().getOrder()<l.getOrder()&&a.getOrder()<m[u].getPipe().getOrder())return!1}}return!0},g.setAcceptedDestinations=function(e,t){for(var r=i.getFlowDiagram().getFlowNodes(),o=e.getNode(),n=0;n<r.length;n++)r[n].hideRefPorts(),r[n].equals(o)||r[n].setDNDAcceptingPorts(e,t)},g.resetNodesDNDFlags=function(){for(var e=i.getFlowDiagram().getFlowNodes(),t=0;t<e.length;t++)e[t].resetDNDFlags()},g.getAcceptingPortForPoint2=function(e,t){for(var r=i.getFlowDiagram().getFlowNodes(),o=e.getNode(),n=0;n<r.length;n++)if(!r[n].equals(o)){var g=r[n].getAcceptingPortForPoint(e,t);if(g)return g}},g.getAcceptingPortForPoint3=function(e,r,o){return o&&(o.getType(),t.portType().LINK_CNX),o.containsPoint(r)?o:g.getAcceptingPortForPoint2(e,r)},g.canDropOnLink=function(e){var r=o.getFlowTypeForGalleryId(e);return r===t.flowType().PROCESS||r===t.flowType().DECISION||r===t.flowType().IN_OUT},g.getDragOverTooltip=function(e){var n=o.getFlowTypeForGalleryId(e),g=" Drop node in ";return n===t.flowType().START?g+="start layer ":n===t.flowType().END?g+="end layer ":n===t.flowType().LEFT_TOP?g+=r.getFlowDirection()===t.flow().VERTICAL?"left swim lane ":"top swim lane ":n===t.flowType().RIGHT_BOTTOM?g+=r.getFlowDirection()===t.flow().VERTICAL?"right swim lane ":"bottom swim lane ":g+="main canvas ",g}}return g});