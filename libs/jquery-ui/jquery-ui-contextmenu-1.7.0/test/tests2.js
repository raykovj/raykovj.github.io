function TestHelpers(){var e="",n=[],t=jQuery;return{log:function(o,i){i&&(n.length=0),void 0===o&&(o=e),n.push(t.trim(o))},logOutput:function(){return n.join(",")},clearLog:function(){n.length=0},click:function(n,t){e=t,window.console.log("click: ",n.children(":eq("+t+")").find("a:first").length),n.children(":eq("+t+")").find("a:first").trigger("click")},entry:function(e,n){return e.children(":eq("+n+")")}}}jQuery(document).ready(function(){function e(e){var n,t;window.console.log("TEST 1 --------------------------------------"),expect(11),a("#container").contextmenu({delegate:".hasmenu",menu:e,beforeOpen:function(e,n){o("beforeOpen"),equal(e.type,"contextmenubeforeopen","beforeOpen: Got contextmenubeforeopen event"),equal(n.target.text(),"AAA","beforeOpen: ui.target is set"),ok(t.is(":hidden"),"beforeOpen: Menu is hidden"),ok(!c(t,0).hasClass("ui-state-disabled"),"beforeOpen: Entry 0 is enabled"),ok(c(t,2).hasClass("ui-state-disabled"),"beforeOpen: Entry 2 is disabled"),a("#container").contextmenu("enableEntry","cut",!1),ok(c(t,0).hasClass("ui-state-disabled"),"beforeOpen: Entry 0 is disabled")},open:function(e){o("open"),ok(t.is(":visible"),"open: Menu is visible"),ok(c(t,2).hasClass("ui-state-disabled"),"open: Entry is disabled")}}),n=a(":moogle-contextmenu"),t=n.contextmenu("getMenu"),equal(n.length,1,"widget created"),ok(t.is(":hidden"),"Menu is hidden"),o("open()"),n.contextmenu("open",a("span.hasmenu:first")),o("after open()"),setTimeout(function(){equal(i(),"open(),beforeOpen,after open(),open","Event sequence OK."),window.console.log("TEST 1 END ----------------------------------"),start()},500)}function n(e){var n,t;window.console.log("TEST 2 --------------------------------------"),expect(3),a("#container").contextmenu({delegate:".hasmenu",menu:e,beforeOpen:function(e,n){o("beforeOpen("+n.target.text()+")")},create:function(e,n){o("create")},createMenu:function(e,n){o("createMenu")},select:function(e,n){window.console.log("select");var t=n.item?a(n.item).find("a:first").attr("href"):n.item;o("select("+t+")"),equal(n.cmd,"cut","select: ui.cmd is set"),equal(n.target.text(),"AAA","select: ui.target is set")},open:function(e){o("open"),setTimeout(function(){var e=n.data("moogle-contextmenu");e.$menu.data("ui-menu");u(t,0),console.log(t,n)},10)},close:function(e){o("close")}}),n=a(":moogle-contextmenu"),t=n.contextmenu("getMenu"),o("open()"),n.contextmenu("open",a("span.hasmenu:first")),o("after open()"),setTimeout(function(){equal(i(),"createMenu,create,open(),beforeOpen(AAA),after open(),open,select(#cut),close","Event sequence OK."),window.console.log("TEST 2 END ----------------------------------"),start()},500)}QUnit.log(function(e){window.console&&window.console.log}),QUnit.config.requireExpects=!0;var t=new TestHelpers,o=t.log,i=t.logOutput,u=t.click,c=t.entry,s={setup:function(){t.clearLog(),a("#sampleMenuTemplate").clone().attr("id","sampleMenu").appendTo("body")},teardown:function(){a(":moogle-contextmenu").contextmenu("destroy"),a("#sampleMenu").remove()}},l=[{title:"Cut",cmd:"cut",uiIcon:"ui-icon-scissors"},{title:"Copy",cmd:"copy",uiIcon:"ui-icon-copy"},{title:"Paste",cmd:"paste",uiIcon:"ui-icon-clipboard",disabled:!0},{title:"----"},{title:"More",children:[{title:"Sub Item 1",cmd:"sub1"},{title:"Sub Item 2",cmd:"sub2"}]}],a=jQuery;module("open",s),asyncTest("UL menu",function(){e("ul#sampleMenu")}),asyncTest("Array menu",function(){e(l)}),module("click event sequence",s),asyncTest("Array menu",function(){n(l)}),asyncTest("UL menu",function(){n("ul#sampleMenu")})});