function TestHelpers(){var e="",t=[],n=jQuery,o=n.ui.menu.version.match(/^(\d)\.(\d+)/),c={major:parseInt(o[1],10),minor:parseInt(o[2],10)};return{log:function(o,c){c&&(t.length=0),void 0===o&&(o=e),t.push(n.trim(o))},logOutput:function(){return t.join(",")},clearLog:function(){t.length=0},entryEvent:function(t,n,o){e=n,c.major<2&&c.minor<11?t.children(":eq("+n+")").find("a:first").trigger(o):t.children(":eq("+n+")").trigger(o)},click:function(t,n){e=n,c.major<2&&c.minor<11?t.children(":eq("+n+")").find("a:first").trigger("click"):t.children(":eq("+n+")").trigger("click")},entry:function(e,t){return e.children(":eq("+t+")")}}}jQuery(document).ready(function(){function e(e){var t;expect(5),c("constructor"),m("#container").contextmenu({delegate:".hasmenu",menu:e,preventSelect:!0,create:function(){c("create")},createMenu:function(){c("createMenu")}}),c("afterConstructor"),t=m(":moogle-contextmenu"),equal(t.length,1,"widget created"),equal(m("head style.moogle-contextmenu-style").length,1,"global stylesheet created"),t.contextmenu("destroy"),equal(m(":moogle-contextmenu").length,0,"widget destroyed"),equal(m("head style.moogle-contextmenu-style").length,0,"global stylesheet removed"),equal(u(),"constructor,createMenu,create,afterConstructor","Event sequence OK.")}function t(e){var t,n;expect(18),m("#container").contextmenu({delegate:".hasmenu",menu:e,beforeOpen:function(e,o){c("beforeOpen"),equal(e.type,"contextmenubeforeopen","beforeOpen: Got contextmenubeforeopen event"),equal(o.target.text(),"AAA","beforeOpen: ui.target is set"),ok(n.is(":hidden"),"beforeOpen: Menu is hidden"),ok(!a(n,0).hasClass("ui-state-disabled"),"beforeOpen: Entry 0 is enabled"),ok(a(n,2).hasClass("ui-state-disabled"),"beforeOpen: Entry 2 is disabled"),ok(t.contextmenu("isOpen"),"isOpen() false in beforeOpen event"),m("#container").contextmenu("enableEntry","cut",!1),m("#container").contextmenu("showEntry","copy",!1)},open:function(e){c("open"),ok(n.is(":visible"),"open: Menu is visible"),ok(a(n,2).hasClass("ui-state-disabled"),"open: Entry is disabled"),ok(t.contextmenu("isOpen"),"isOpen() true in open event"),ok(a(n,0).is(":visible"),"beforeOpen: Entry 0 is visible"),ok(a(n,0).hasClass("ui-state-disabled"),"beforeOpen: Entry 0 is disabled: enableEntry(false) worked"),ok(a(n,1).is(":hidden"),"beforeOpen: Entry 1 is hidden: showEntry(false) worked"),ok(!a(n,1).hasClass("ui-state-disabled"),"beforeOpen: Entry 1 is enabled"),equal(u(),"open(),beforeOpen,after open(),open","Event sequence OK."),start()}}),t=m(":moogle-contextmenu"),n=t.contextmenu("getMenu"),ok(n,"getMenu() works"),ok(!t.contextmenu("isOpen"),"menu initially closed"),equal(t.length,1,"widget created"),ok(n.is(":hidden"),"Menu is hidden"),c("open()"),t.contextmenu("open",m("span.hasmenu:first")),c("after open()")}function n(e){var t,n;expect(3),m("#container").contextmenu({delegate:".hasmenu",menu:e,beforeOpen:function(e,t){c("beforeOpen("+t.target.text()+")")},create:function(e,t){c("create")},createMenu:function(e,t){c("createMenu")},select:function(e,t){var n=t.item?m(t.item).attr("data-command"):t.item;c("select("+n+")"),equal(t.cmd,"cut","select: ui.cmd is set"),equal(t.target.text(),"AAA","select: ui.target is set")},open:function(e){c("open"),setTimeout(function(){s(n,0,"mouseenter"),i(n,0)},10)},close:function(e){c("close")}}),t=m(":moogle-contextmenu"),n=t.contextmenu("getMenu"),c("open()"),t.contextmenu("open",m("span.hasmenu:first")),c("after open()"),setTimeout(function(){equal(u(),"createMenu,create,open(),beforeOpen(AAA),after open(),open,select(cut),close","Event sequence OK."),start()},1e3)}QUnit.config.requireExpects=!0;var o=new TestHelpers,c=o.log,u=o.logOutput,i=o.click,s=o.entryEvent,a=o.entry,r={setup:function(){o.clearLog(),m("#sampleMenuTemplate").clone().attr("id","sampleMenu").appendTo("body")},teardown:function(){m(":moogle-contextmenu").contextmenu("destroy"),m("#sampleMenu").remove()}},l=[{title:"Cut",cmd:"cut",uiIcon:"ui-icon-scissors"},{title:"Copy",cmd:"copy",uiIcon:"ui-icon-copy"},{title:"Paste",cmd:"paste",uiIcon:"ui-icon-clipboard",disabled:!0},{title:"----"},{title:"More",children:[{title:"Sub Item 1",cmd:"sub1"},{title:"Sub Item 2",cmd:"sub2"}]}],m=jQuery,d=[];QUnit.testStart(function(e){QUnit.log(function(t){t.result||(t.name=e.name,d.push(t))})}),QUnit.done(function(e){var t,n,o,c=[];for(t=0,n=d.length;t<n;t++)o=d[t],c.push({name:o.name,result:o.result,expected:o.expected,actual:o.actual,source:o.source});e.tests=c,window.global_test_results=e}),module("prototype",r),test("globals",function(){expect(2),ok(!!m.moogle.contextmenu,"exists in ui namnespace"),ok(!!m.moogle.contextmenu.version,"has version number")}),module("create",r),test("create from UL",function(){e("ul#sampleMenu")}),test("create from array",function(){e(l)}),module("open",r),asyncTest("UL menu",function(){t("ul#sampleMenu")}),asyncTest("Array menu",function(){t(l)}),module("click event sequence",r),asyncTest("Array menu",function(){n(l)}),asyncTest("UL menu",function(){n("ul#sampleMenu")}),module("'action' option",r),asyncTest("Array menu",function(){var e,t,n=[{title:"Cut",cmd:"cut",uiIcon:"ui-icon-scissors",action:function(e,t){c("cut action"),equal(t.cmd,"cut","action: ui.cmd is set"),equal(t.target.text(),"AAA","action: ui.target is set")}},{title:"Copy",cmd:"copy",uiIcon:"ui-icon-copy"},{title:"Paste",cmd:"paste",uiIcon:"ui-icon-clipboard",disabled:!0}];expect(5),m("#container").contextmenu({delegate:".hasmenu",menu:n,open:function(e){c("open"),setTimeout(function(){i(t,0)},10)},select:function(e,t){var n=t.item?m(t.item).attr("data-command"):t.item;c("select("+n+")"),equal(t.cmd,"cut","select: ui.cmd is set"),equal(t.target.text(),"AAA","select: ui.target is set")},close:function(e){c("close")}}),e=m(":moogle-contextmenu"),t=e.contextmenu("getMenu"),c("open()"),e.contextmenu("open",m("span.hasmenu:first")),c("after open()"),setTimeout(function(){equal(u(),"open(),after open(),open,select(cut),cut action,close","Event sequence OK."),start()},500)})});